angular.module("MyApp").controller("DetailCtrl",["$scope","$interval","$rootScope","$window","$routeParams","$location","$alert","$upload","fb_appId","Activity","Profile","Subscription","DoneIt","Tips","Selfies","Accept","Delete","Session","Auth",function(e,t,i,s,n,o,a,l,r,c,u,p,y,f,d,m,v,g,b){s.scrollTo(0,0),e.session=g,e.session.success(function(e){"OK"!=e.session&&(s.fbAsyncInit=function(){FB.init({appId:r,responseType:"token",version:"v2.2",cookie:!0,status:!0,xfbml:!0}),b.logout()})}),s.fbAsyncInit=function(){FB.init({appId:r,responseType:"token",version:"v2.2",cookie:!0,status:!0,xfbml:!0})},c.get({_id:n.id},function(n){e.activity=n,e.fb_share=function(){FB.ui({method:"feed",name:n.title,link:"http://joyage.in/activities/"+n._id,picture:"https://s3-ap-southeast-1.amazonaws.com/joyage-images/"+n.poster,description:n.description})},e.subscriptions=n.subscriptions,e.completions=n.completions,e.isSubscribed=function(){return i.currentUser?-1!==e.activity.subscribers.indexOf(i.currentUser._id):void 0},e.subscribe=function(){p.subscribe(n).success(function(){e.activity.subscribers.push(i.currentUser._id),e.subscriptions+=1})},e.unsubscribe=function(){p.unsubscribe(n).success(function(){var t=e.activity.subscribers.indexOf(i.currentUser._id);e.activity.subscribers.splice(t,1),e.subscriptions-=1})},e.isDone=function(){return i.currentUser?-1!==e.activity.doneIt.indexOf(i.currentUser._id):void 0},e.markDone=function(){y.markDone(n).success(function(){e.activity.doneIt.push(i.currentUser._id),e.completions+=1})},e.markUndone=function(){y.markUndone(n).success(function(){var t=e.activity.doneIt.indexOf(i.currentUser._id);e.activity.doneIt.splice(t,1),e.completions-=1})},e.activity.tipper&&-1==e.activity.tipper.indexOf(i.currentUser._id)&&(e.editTips=!0),e.addTips=function(t){t&&e.activity.tipper&&-1==e.activity.tipper.indexOf(i.currentUser._id)&&(e.activity.tips.push(t),f.addTip(n).success(function(){e.tip=""}),s.location.reload())};var r="";e.activity.selfie_sub||(e.activity.selfie_sub=[]),e.onSelfieSelect=function(t){if(console.log(t),1===t.length)if(-1==e.activity.selfie_sub.indexOf(i.currentUser._id))for(var s=0;s<t.length;s++){var n=t[s];e.upload=l.upload({url:"/uploadSelfie",data:{myObj:e.myModelObj},file:n}).progress(function(e){console.log("percent: "+parseInt(100*e.loaded/e.total))}).success(function(t){r=t.imageurl,e.selfieImg=r,console.log("Selfie: "+r)})}else a({content:"You can upload only one selfie per activity",placement:"bottom-left",type:"material",duration:3});else a({content:"You can upload only one selfie per activity",placement:"bottom-left",type:"material",duration:3})},e.activity.selfie_sub&&-1==e.activity.selfie_sub.indexOf(i.currentUser._id)&&(e.addS=!0),e.ii=[];for(var c=24-e.activity.selfiesNumber,u=1;c>=u;u++)e.ii.push(u);var g=0;t(function(){if(1>g)for(var e=1;c>=e;e++){var t=document.getElementById(e);t.style.width="100px",t.style.height="100px"}g+=1},10),e.addSelfies=function(){e.activity.selfie_sub&&-1==e.activity.selfie_sub.indexOf(i.currentUser._id)&&""!=r&&(e.activity.selfies=r,d.addSelfie(e.activity).success(function(){e.selfies=""}),s.location.reload())},e.acceptActivity=function(e){m.acceptActivity(n,e).success(function(){a({content:"Activity has been added.",placement:"bottom-left",type:"success",duration:3}),o.path("/admin/"+i.currentUser._id)})},e.deleteActivity=function(){v.deleteActivity(n).success(function(){a({content:"Activity deleted",placement:"bottom-left",type:"material",duration:3}),o.path("/admin"+i.currentUser._id)})};var b;!function(){function e(e,t){var i=document.getElementById("cd-zoom-in"),s=document.getElementById("cd-zoom-out");e.appendChild(i),e.appendChild(s),google.maps.event.addDomListener(i,"click",function(){t.setZoom(t.getZoom()+1)}),google.maps.event.addDomListener(s,"click",function(){t.setZoom(t.getZoom()-1)})}function t(){p.setAnimation(null!=p.getAnimation()?null:google.maps.Animation.BOUNCE)}var i=navigator.userAgent.toLowerCase().indexOf("trident")>-1,s=i?"https://s3-us-west-2.amazonaws.com/s.cdpn.io/148866/cd-icon-location.png":"https://s3-us-west-2.amazonaws.com/s.cdpn.io/148866/cd-icon-location_1.svg";if(12.9539==n.mapLat&&77.6309==n.mapLon)var o=10;else if(28.6336==n.mapLat&&77.2225==n.mapLon)var o=10;else if(19.0822==n.mapLat&&72.8812==n.mapLon)var o=10;else var o=15;var a="#47a2be",l=-20,r=5,c=[{elementType:"labels",stylers:[{saturation:l}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"poi.government",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"poi.sport_complex",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"transit",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"transit.station",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"landscape",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"road",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]},{featureType:"water",elementType:"geometry",stylers:[{hue:a},{visibility:"on"},{lightness:r},{saturation:l}]}],u={zoom:o,center:new google.maps.LatLng(n.mapLat,n.mapLon),mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,styles:c};b=new google.maps.Map(document.getElementById("google-container"),u);{var p=new google.maps.Marker({position:new google.maps.LatLng(n.mapLat,n.mapLon),map:b,title:n.location,animation:google.maps.Animation.DROP,icon:s,visible:!0}),y=document.createElement("div");new e(y,b)}b.controls[google.maps.ControlPosition.LEFT_TOP].push(y),google.maps.event.addListener(p,"click",t)}(),google.maps.event.addDomListener(window,"load"),$(function(){$(".open-modal").click(function(){for(var e=$(this)[0],t=e.className.split(/\s+/),i=0;i<t.length;i++)if(t[i].match(/modal-/)){var s=t[i];$(".modal."+s).fadeIn("fast")}}),$(".close-modal").click(function(){$(this).closest(".modal").fadeOut("fast")}),$(".button-facebook").click(function(){$(this).toggleClass("button-facebook-fill")})}())}),e.userMenu=function(){var e=document.getElementById("user-menu-drawer");e.style&&(e.style.display="block"==e.style.display?"none":"block")},$(".open-modal").click(function(){for(var e=$(this)[0],t=e.className.split(/\s+/),i=0;i<t.length;i++)if(t[i].match(/modal-/)){var s=t[i];$(".modal."+s).fadeIn("fast")}})}]);