angular.module("MyApp").controller("DetailCtrl",["$scope","$rootScope","$window","$routeParams","$location","$alert","$upload","fb_appId","Activity","Profile","Subscription","DoneIt","Tips","Selfies","Accept","Delete","Session","Auth",function(e,t,i,o,n,s,l,a,r,c,u,p,y,d,f,m,g,v){i.scrollTo(0,0),e.session=g,e.session.success(function(e){console.log("Data: "+e.session),"expired"==e.session&&(i.fbAsyncInit=function(){FB.init({appId:a,responseType:"token",version:"v2.2",cookie:!0,status:!0,xfbml:!0}),v.logout()})}),i.fbAsyncInit=function(){FB.init({appId:a,responseType:"token",version:"v2.2",cookie:!0,status:!0,xfbml:!0})},r.get({_id:o.id},function(o){e.activity=o,e.activities=r.query({limit:3,id:o._id}),e.fb_share=function(){FB.ui({method:"feed",name:o.title,link:"http://joyage.in/activities/"+o._id,description:o.description})},e.subscriptions=o.subscriptions,e.completions=o.completions,e.isSubscribed=function(){return t.currentUser?-1!==e.activity.subscribers.indexOf(t.currentUser._id):void 0},e.subscribe=function(){u.subscribe(o).success(function(){e.activity.subscribers.push(t.currentUser._id),e.subscriptions+=1})},e.unsubscribe=function(){u.unsubscribe(o).success(function(){var i=e.activity.subscribers.indexOf(t.currentUser._id);e.activity.subscribers.splice(i,1),e.subscriptions-=1})},e.isDone=function(){return t.currentUser?-1!==e.activity.doneIt.indexOf(t.currentUser._id):void 0},e.markDone=function(){p.markDone(o).success(function(){e.activity.doneIt.push(t.currentUser._id),e.completions+=1})},e.markUndone=function(){p.markUndone(o).success(function(){var i=e.activity.doneIt.indexOf(t.currentUser._id);e.activity.doneIt.splice(i,1),e.completions-=1})},-1==e.activity.tipper.indexOf(t.currentUser._id)&&(e.editTips=!0),e.addTips=function(n){-1==e.activity.tipper.indexOf(t.currentUser._id)&&(e.activity.tips.push(n),y.addTip(o).success(function(){e.tip=""}),i.location.reload())};var a="";e.activity.selfie_sub||(e.activity.selfie_sub=[]),e.onSelfieSelect=function(i){if(console.log(i),1===i.length)if(-1==e.activity.selfie_sub.indexOf(t.currentUser._id))for(var o=0;o<i.length;o++){var n=i[o];console.log("File: "+n),e.upload=l.upload({url:"/uploadSelfie",data:{myObj:e.myModelObj},file:n}).progress(function(e){console.log("percent: "+parseInt(100*e.loaded/e.total))}).success(function(t){a=t.imageurl,e.selfieImg=a,console.log("Selfie: "+a)})}else s({content:"You can upload only one selfie per activity",placement:"top-right",type:"material",duration:3});else s({content:"You can upload only one selfie per activity",placement:"top-right",type:"material",duration:3})},-1==e.activity.selfie_sub.indexOf(t.currentUser._id)&&(e.addS=!0),e.addSelfies=function(){-1==e.activity.selfie_sub.indexOf(t.currentUser._id)&&(e.activity.selfies=a,d.addSelfie(e.activity).success(function(){e.selfies=""}),i.location.reload())},e.acceptActivity=function(e){f.acceptActivity(o,e).success(function(){s({content:"Activity has been added.",placement:"top-right",type:"success",duration:3}),n.path("/admin")})},e.deleteActivity=function(){m.deleteActivity(o).success(function(){s({content:"Activity deleted",placement:"top-right",type:"material",duration:3}),n.path("/admin")})};var c;!function(){function e(e,t){var i=document.getElementById("cd-zoom-in"),o=document.getElementById("cd-zoom-out");e.appendChild(i),e.appendChild(o),google.maps.event.addDomListener(i,"click",function(){t.setZoom(t.getZoom()+1)}),google.maps.event.addDomListener(o,"click",function(){t.setZoom(t.getZoom()-1)})}function t(){y.setAnimation(null!=y.getAnimation()?null:google.maps.Animation.BOUNCE)}var i=navigator.userAgent.toLowerCase().indexOf("trident")>-1,n=i?"https://s3-us-west-2.amazonaws.com/s.cdpn.io/148866/cd-icon-location.png":"https://s3-us-west-2.amazonaws.com/s.cdpn.io/148866/cd-icon-location_1.svg";if(12.9667==o.mapLat&&77.5667==o.mapLon)var s=10;else var s=15;var l="#2d313f",a=-20,r=5,u=[{elementType:"labels",stylers:[{saturation:a}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"poi.government",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"poi.sport_complex",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"transit",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"transit.station",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"landscape",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"road",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]},{featureType:"water",elementType:"geometry",stylers:[{hue:l},{visibility:"on"},{lightness:r},{saturation:a}]}],p={zoom:s,center:new google.maps.LatLng(o.mapLat,o.mapLon),mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,styles:u};c=new google.maps.Map(document.getElementById("google-container"),p);{var y=new google.maps.Marker({position:new google.maps.LatLng(o.mapLat,o.mapLon),map:c,title:o.location,animation:google.maps.Animation.DROP,icon:n,visible:!0}),d=document.createElement("div");new e(d,c)}c.controls[google.maps.ControlPosition.LEFT_TOP].push(d),google.maps.event.addListener(y,"click",t)}(),google.maps.event.addDomListener(window,"load"),$(function(){$(".open-modal").click(function(){for(var e=$(this)[0],t=e.className.split(/\s+/),i=0;i<t.length;i++)if(t[i].match(/modal-/)){var o=t[i];$(".modal."+o).fadeIn("fast")}}),$(".close-modal").click(function(){$(this).closest(".modal").fadeOut("fast")}),$(".button-facebook").click(function(){$(this).toggleClass("button-facebook-fill")})}())}),e.go=function(e){n.path(e)},e.userMenu=function(){var e=document.getElementById("user-menu-drawer");e.style&&(e.style.display="block"==e.style.display?"none":"block")},$(".open-modal").click(function(){console.log("Modal");for(var e=$(this)[0],t=e.className.split(/\s+/),i=0;i<t.length;i++)if(t[i].match(/modal-/)){var o=t[i];$(".modal."+o).fadeIn("fast")}})}]);