function html_unescape(e){return e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&quot;/g,'"'),e=e.replace(/&#39;/g,"'"),e=e.replace(/&amp;/g,"&")}function id_to_windowname(e){return e=e.replace(/\./g,"__dot__"),e=e.replace(/\-/g,"__dash__")}function windowname_to_id(e){return e=e.replace(/__dot__/g,"."),e=e.replace(/__dash__/g,"-")}function showRelatedObjectLookupPopup(e,t){var i,o=e.id.replace(/^lookup_/,"");if(o=id_to_windowname(o),i=e.href.search(/\?/)>=0?e.href+"&pop=1":e.href+"?pop=1",t)var n=window.open(i,o,"height=800,width=1000,resizable=yes,scrollbars=yes");else var n=window.open(i,o,"height=1000,width=1440,resizable=yes,scrollbars=yes");return n.focus(),!1}function showRelatedObjectLookupPopupUsingNonNexusUrl(e,t,i){var o,n,a,r,c=e.id.replace(/^lookup_/,""),s=!1;if(c=id_to_windowname(c),n=document.location.pathname,a=n.split("/").filter(function(e){return e?e:void 0}),i=i||{},r=a[a.length-1],o=e.href.search(/\?/)>=0?e.href+"&"+$.param(i)+"&pop=1":e.href+"?"+$.param(i)+"&pop=1",parseInt(r,10)&&(o=o+"&id="+r,s=!0),"activity"===a[a.length-2]&&s&&(o+="&act=true"),t)var l=window.open(o,c,"height=800,width=1000,resizable=yes,scrollbars=yes");else var l=window.open(o,c,"height=1000,width=1440,resizable=yes,scrollbars=yes");return l.focus(),!1}function showRelatedObjectLookupWithParams(e,t,i){var o=e.href,n=e.id.replace(/^lookup_/,"");if(o=o.search(/\?/)>=0?o+"&"+$.param(t)+"&pop=1":o+"?"+$.param(t)+"&pop=1",i){window.open(o,n,"height=800,width=1000,resizable=yes,scrollbars=yes")}else{window.open(o,n,"height=1000,width=1440,resizable=yes,scrollbars=yes")}return!1}function useValueFromRelatedLookupPopup(e,t){var i=windowname_to_id(e.name),o=document.getElementById(i);-1!=o.className.indexOf("vManyToManyRawIdAdminField")&&o.value?o.value+=","+t:document.getElementById(i).value=t,jQuery(document).trigger(i+"_nexus_select",[t])}function dismissRelatedLookupPopup(e,t){var i=windowname_to_id(e.name),o=document.getElementById(i);-1!=o.className.indexOf("vManyToManyRawIdAdminField")&&o.value?o.value+=","+t:document.getElementById(i).value=t,e.close(),jQuery(document).trigger(i+"_nexus_select",[t])}function dismissRelatedLookupPopupWithPreview(e,t,i,o){var n=windowname_to_id(e.name),a=document.getElementById(n);-1!=a.className.indexOf("vManyToManyRawIdAdminField")&&a.value?a.value+=","+t:document.getElementById(n).value=t,o&&(i=o(i)),$(a).siblings("div").html(i),e.close(),jQuery(document).trigger(n+"_nexus_select",[t])}function showAddAnotherPopup(e){var t=e.id.replace(/^add_/,"");t=id_to_windowname(t),href=e.href,href+=-1==href.indexOf("?")?"?_popup=1":"&_popup=1";var i=window.open(href,t,"height=1000,width=1440,resizable=yes,scrollbars=yes");return i.focus(),!1}function showEditAnotherPopup(e){var t=e.id.replace(/^edit_/,"");t=id_to_windowname(t),href=e.href,href+=-1==href.indexOf("?")?"?_popup=1":"&_popup=1";var i=window.open(href,t,"height=1000,width=1440,resizable=yes,scrollbars=yes");return i.focus(),!1}function dismissAddAnotherPopup(e,t,i){t=html_unescape(t),i=html_unescape(i);var o=windowname_to_id(e.name),n=document.getElementById(o);if(n){var a=n.nodeName.toUpperCase();if("SELECT"==a){var r=new Option(i,t);n.options[n.options.length]=r,r.selected=!0}else"INPUT"==a&&(-1!=n.className.indexOf("vManyToManyRawIdAdminField")&&n.value?n.value+=","+t:n.value=t);n.focus()}else{var c=o+"_to";n=document.getElementById(c);var r=new Option(i,t);SelectBox.add_to_cache(c,r),SelectBox.redisplay(c)}e.close(),jQuery(document).trigger(o+"_nexus_select",[t])}function dismissAndTriggerEvent(e,t){var i=windowname_to_id(e.name);e.close(),jQuery(document).trigger(i+"_nexus_select",[t])}var OFFLINE=function(e,t){"use strict";var i=e.logger=e.logger||{},o=(e.dragon=e.dragon||{},e.base=e.base||{});return i.log_event=function(e,i,n,a){a=a||{},o.server_call("l",{event:i,area:e,message:n,params:t.toJSON(a)})},i.log_search_query=function(e,i,n){n=n||{},o.server_call("lsqc",{log_type:"query",area:e,message:i,params:t.toJSON(n)})},i.log_search_results=function(e,i){i=i||{},o.server_call("lsqc",{log_type:"results",area:"",message:e,params:t.toJSON(i)})},i.log_search_click=function(e,i,n){n=n||{},o.server_call("lsqc",{log_type:"click",area:e,message:i,params:t.toJSON(n)})},i.log_ab_entry=function(e,t){o.server_call("lab",{event:"entry",area:e,message:t})},i.log_ab_exit=function(e,t){o.server_call("lab",{event:"exit",area:e,message:t})},i.set_page=function(e,n,a,r){var c,s={},l=/^https?:\/\/(secure\.)?sosh\.com\//;r=r||{},i.page_name=e,n&&("DEVELOPMENT"==o.environment&&void 0===a&&console.log("ERROR: ID PASSED WITH NO NAME"),r.id=n,i.page_name_id=a,i.internal_page_id=n),c=t.getQueryParam("ref"),c&&(r.ref=c),s=t.getQueryParam("inv"),s&&(r.inv=s),document.referrer&&!document.referrer.match(l)&&(r.ref_url=document.referrer),o.server_call("lpv",{message:e,params:t.toJSON(r)})},i.log_view=function(e,n,a){var r,c;a=a||{},r=t.getQueryParam("ref"),r&&(a.ref=r),c=t.getQueryParam("inv"),c&&(a.inv=c),i.page_name?a.page_name=i.page_name:"DEVELOPMENT"==o.environment&&console.log("ERROR: PAGE NAME NOT SET"),i.page_name_id&&(void 0===a[i.page_name_id]?a[i.page_name_id]=i.internal_page_id:"DEVELOPMENT"==o.environment&&console.log("ERROR: PARAM WITH SAME NAME ALREADY DEFINED: "+i.page_name_id)),o.server_call("lv",{area:e,message:n,params:t.toJSON(a)})},i.log_summary_view=function(e,n){var a,r;if(n=n||{},i.page_name?n.page_name=i.page_name:"DEVELOPMENT"==o.environment&&console.log("ERROR: PAGE NAME NOT SET"),i.page_name_id&&(void 0===n[i.page_name_id]?n[i.page_name_id]=i.internal_page_id:"DEVELOPMENT"==o.environment&&console.log("ERROR: PARAM WITH SAME NAME ALREADY DEFINED: "+i.page_name_id)),o.server_call("lsv",{area:e,params:t.toJSON(n)}),"DEVELOPMENT"==o.environment){a={debug:"SUMMARYVIEW: loging to /jx/lsv and console",area:e,params:t.toJSON(n)};for(r in a)a.hasOwnProperty(r)&&console.log(r+" : "+a[r]);console.log("-------------")}},i.log_click=function(e,n,a){a=a||{};var r,c=t.getQueryParam("ref");c&&(a.ref=c),r=t.getQueryParam("inv"),r&&(a.inv=r),i.page_name?a.page_name=i.page_name:"DEVELOPMENT"==o.environment&&console.log("ERROR: PAGE NAME NOT SET"),i.page_name_id&&(void 0===a[i.page_name_id]?a[i.page_name_id]=i.internal_page_id:"DEVELOPMENT"==o.environment&&console.log("ERROR: PARAM WITH SAME NAME ALREADY DEFINED: "+i.page_name_id)),o.server_call("lc",{area:e,message:n,params:t.toJSON(a)})},t(document).ready(function(){var e=function(){var e=t(this);return i.log_click(e.data("log-area"),e.data("log-message"),e.data("log-params")),!0};t("*[data-log-area]").live("mousedown",e)}),e}(OFFLINE||{},jQuery);jQuery.ajaxSetup({beforeSend:function(e,t){"use strict";function i(e){var t,i,o,n=null;if(document.cookie&&""!==document.cookie)for(t=document.cookie.split(";"),i=0;i<t.length;i++)if(o=jQuery.trim(t[i]),o.substring(0,e.length+1)==e+"="){n=decodeURIComponent(o.substring(e.length+1));break}return n}/^http:.*/.test(t.url)||/^https:.*/.test(t.url)||e.setRequestHeader("X-CSRFToken",i("csrftoken"))},jsonp:null,jsonpCallback:null}),function(){"use strict";var e,t=0,i=["webkit","moz"];for(e=0;e<i.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[i[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[e]+"CancelAnimationFrame"]||window[i[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),o=Math.max(0,16-(i-t)),n=window.setTimeout(function(){e(i+o)},o);return t=i+o,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(e){"use strict";e.getQueryParam=function(e,t){var i,o,n="undefined"!=typeof t?t.search:location.search,a=n.substring(1).split("&");for(i=0;i<a.length;i++)if(o=a[i].split("="),o[0]==e)return o[1]||"";return void 0}}(jQuery),String.prototype.format=function(){"use strict";var e=arguments;return this.replace(/{(\d+)}/g,function(t,i){return"undefined"!=typeof e[i]?e[i]:t})},"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){"use strict";return-1!==this.indexOf(e,this.length-e.length)});var OFFLINE=function(e){"use strict";var t=e.base=e.base||{},i=e.logger=e.logger||{};return t.log_event=i.log_event,t.log_view=i.log_view,t.log_click=i.log_click,t.log_ab_entry=i.log_ab_entry,t.log_ab_exit=i.log_ab_exit,t.set_page=i.set_page,t.log_search_query=i.log_search_query,t.log_search_results=i.log_search_results,t.log_search_click=i.log_search_click,t.server_call=function(e,t,i){var o="/jx/"+e;return t=t||{},$.post(o,t,i)},t.make_static_url=function(e){return t.static_prefix+e},t.load_deferred_images=function(){$("img.deferred").each(function(){var e=$(this);e.removeClass("deferred").attr("src",e.data("deferred-src"))})},t.bookmark_activity=function(e,i,o,n){t.server_call("bookmark_activity",{activity_id:e,value:i,src:n,ref:$.getQueryParam("ref")},o)},t.getCookie=function(e){var t,i,o,n=null;if(document.cookie&&""!==document.cookie)for(t=document.cookie.split(";"),i=0;i<t.length;i++)if(o=jQuery.trim(t[i]),o.substring(0,e.length+1)==e+"="){n=decodeURIComponent(o.substring(e.length+1));break}return n},t.paramReplace=function(e,t,i){var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=o.exec(t)[0].charAt(0),a=t.replace(o,n+e+"="+i);return a},t.create_spinner=function(e,t,i){var o={lines:12,length:4,width:2,radius:t||5,color:i||"#fff",speed:1,trail:60,shadow:!1},n=new Spinner(o).spin();return e.append(n.el),n},t.maintainOriginalRef=function(e){var i=$.getQueryParam("ref");i&&$(e).find("a").each(function(e,o){var n=$.getQueryParam("ref",o);if(n){var a=$(o).attr("href"),r=i.endsWith(n)?"":"_"+n;a&&$(o).attr("href",t.paramReplace("ref",a,i+r))}})},e}(OFFLINE||{});$(function(){"use strict";$(".sosh-checkbox").on("click",function(){$(this).is(":checked")?$(this).addClass("checked"):$(this).removeClass("checked")})}),function(e){"use strict";e.fn.dropMenu=function(){var t,i,o=e(this),n=e(this).next(".header-user-menu-outer");o.hover(function(){t()},function(){}),n.hover(function(){},function(){i()}),n.children(".header-user-menu-close").hover(function(){i()},function(){}),t=function(){n.is(":hidden")&&n.show()},i=function(){n.is(":visible")&&n.hide()}}}(jQuery),function(e){"use strict";var t={init:function(i){i=i||{},i=e.extend({title:"",maxWidth:700,minWidth:250,buttons:{},autoOpen:!0,onClose:void 0,opacity:.4},i);var o=e(this),n=o.data("mypopup"),a=0;return n||(n={options:i}),n.initialized||(n.overlay=e("<div/>").addClass("overlay"),o.css({"max-width":i.maxWidth+"px","min-width":i.minWidth+"px"}),o.attr("title")&&(n.options.title=n.options.title||o.attr("title"),o.attr("title",null)),n.wrapper=e("<div/>").addClass("dragon-popup-wrapper"),n.options.title&&n.wrapper.append(e("<header/>").append(e("<h1/>").text(i.title),e("<div/>").addClass("dragon-popup-x").addClass("link").click(function(){OFFLINE.dragon.log_click("Popup","X",{title:n.options.title}),t.close.apply(o)}))),o.addClass("dragon-popup"),n.overlay.css({"background-color":"rgba(0,0,0,"+i.opacity+")"}),e("body").append(n.overlay.append(n.wrapper.append(o))),n.buttonbar=e("<div/>").addClass("dragon-popup-buttons"),e.each(n.options.buttons,function(t,i){n.buttonbar.append(e("<div/>").addClass("blue-button-new").text(t).click(function(){i.apply(o,arguments)})),a++}),a&&o.append(n.buttonbar),n.initialized=!0,o.data("mypopup",n)),n.options.autoOpen?t.show.apply(this):this},show:function(i){var o=e(this).data("mypopup"),n=this;return o||(t.init.apply(this,[i]),o=e(this).data("mypopup")),o.wrapper.hide(),o.overlay.fadeIn("fast",function(){o.wrapper.show(),t.recenter.apply(n),o.buttonbar.find("button:last").focus()}),this},close:function(){var t=e(this).data("mypopup");t&&(t.overlay.fadeOut("fast"),t.options.onClose&&t.options.onClose.apply())},update:function(){},recenter:function(){var t=e(this).data("mypopup");t&&t.wrapper.position({my:"center",at:"center",of:t.overlay})}};e.fn.dragonPopup=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void e.error("Method "+i+" does not exist on jQuery.dragonPopup"):t.init.apply(this,arguments)}}(jQuery),$.extend({getUrlVars:function(){"use strict";var e,t,i=[],o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(e=0;e<o.length;e++)t=o[e].split("="),i.push(t[0]),i[t[0]]=t[1];return i}});var OFFLINE=function(e,t,i,o){"use strict";var n,a=e.dragon=e.dragon||{},r=e.dragon.signup=e.dragon.signup||{},c=e.base,s=e.logger;return a.ab_sides={},a.server_call=c.server_call,a.log_event=s.log_event,a.log_view=s.log_view,a.log_click=s.log_click,a.log_ab_entry=s.log_ab_entry,a.log_ab_exit=s.log_ab_exit,a.set_page=s.set_page,a.log_search_query=s.log_search_query,a.log_search_results=s.log_search_results,a.log_search_click=s.log_search_click,a.make_static_url=c.make_static_url,a.logout=c.logout,a.bookmark_activity=c.bookmark_activity,a.log_summary_view=s.log_summary_view,a.SF_BADGE=0,a.NYC_BADGE=1,a.load_deferred_images=function(){c.load_deferred_images(),t("a[title],button[title]").not(".mugshotlink").not(".fancymedo").not(".step2-result-bookmark").not("#home-friend-feed-count-link").not(".home-friend-badge").not(".collection-details-done-this").tooltip({position:"bottom center",opacity:.9,offset:[10,0]}),t(".mugshotlink[title], .feed-big-story-legend[title], #home-friend-feed-count-link[title], .home-friend-badge[title], .collection-details-done-this[title]").tooltip({position:"top center",opacity:.9,offset:[-15,0]}),t(".step2-result-bookmark[title]").tooltip({position:"top center",opacity:.9,offset:[-10,0]})},a.alert=function(e,i){e?t("<div/>").text(e).dragonPopup({buttons:{OK:function(){t(this).dragonPopup("close")}},title:i,maxWidth:800}):"DEVELOPMENT"==c.environment&&window.alert("NO MESSAGE SET FOR ALERT")},a.twitter_authenticate_alert=function(e,i){t("<div/>").text(e).dragonPopup({buttons:{OK:function(){a.twitter_connect_prompt(),t(this).dragonPopup("close")}},title:i,maxWidth:800})},a.make_spinner_dialog=function(e,i){return t("<div/>").css({"text-align":"center"}).append(t("<p/>").text(i),t("<img/>").attr({src:a.make_static_url("/images/ajax-loader.gif")})).dragonPopup({title:e})},a.logout=function(){return a.log_click("Navigation","Logout"),a.server_call("logout",{a:1},function(e){window.location=e.url}),!1},a.header_login_user=function(e){var i,o={},n=t(e);return a.log_click("Signup","Login"),o.username=n.find("input[type=email]").val(),o.password=n.find("input[type=password]").val(),i=function(e){if(0!==e.rc){var i=e.message+" <a href='/me/password/forgot/'>Reset password</a>";a.log_event("Signup","Error","Login failed",{username:o.username,error:e.rc}),2==e.rc?a.alert(e.message):(n.find(".error-display").html(t("<label>").addClass("invalid").html(i)),n.find("input[type=password]").val("").focus().addClass("invalid"))}else window.location.reload(!0)},a.server_call("login",o,i),!1},a.get_more_recommendations=function(e){var i,o={},r=t("#step2-more"),c=function(e){var c;a.getting=!1,n&&n.dragonPopup("close"),0!==e.rc?a.alert(e.message):(c=t(e.results_section),t("#step2-other-activities").append(t("<hr>"),c),a.load_deferred_images(),e.is_more?r.data("page",i+1):r.hide("blind"),a.is_page_reload=!1,location.hash&&JSON.parse(window.unescape(location.hash).slice(1)).filter&&(o=JSON.parse(window.unescape(location.hash).slice(1))),o.page=i,jQuery.history.load(JSON.stringify(o)))};return a.getting?!1:(a.getting=!0,i=r.data("page"),void 0===i&&(i=e),a.log_click("Recommendations","See more recommendations button"),isNaN(e)?a.server_call("get_more_recommendations",{page:i},c):(n=a.make_spinner_dialog("Searching","Fetching more great ideas…"),i=e,a.server_call("get_more_recommendations",{page:i,page_reload:e},c)),!1)},a.get_more_by_category=function(){var e,i=t(this);return e=i.data("page"),a.log_click("Recommendations","Category: See more button"),a.getting||(a.getting=!0,a.server_call("get_more_by_category",{page:e,category_id:a.category_id},function(o){var n;0!==o.rc?a.alert(o.message):(n=t(o.results_section),t("#step2-other-activities").append(t("<hr>"),n),a.load_deferred_images(),a.results_log_summary_view(10*e),o.is_more?i.data("page",e+1):i.hide("blind")),a.getting=!1})),!1},a.add_other_hover_handlers=function(){t(".step2-other-result").live({mouseenter:function(){t(this).find(".search-result-bookmark-notforme-common").animate({opacity:"1"},"fast")},mouseleave:function(){t(this).find(".search-result-bookmark-notforme-common").not(".search-result-bookmark-complete").animate({opacity:"0"},"fast")}})},a.update_category_tallys=function(e){t.each(e,function(e,i){t("#recommendations-filter-what-"+e+"-tally").text("("+i+")")})},a.filter_recommendations=function(e){var i=function(i){n.dragonPopup("close"),t("#recommendation-results").html(i.results_section),0!==i.rc?1!==i.rc&&a.alert(i.message):(a.load_deferred_images(),a.update_category_tallys(i.category_tally),isNaN(e)||a.get_more_recommendations(e))},o={when:t("input[name='recommendations-filter-when']:checked").val(),pwhat:t("input[name='recommendations-filter-pwhat']").val(),where:t("input[name='recommendations-filter-neighborhood']:checked").val(),timeslot:t("input[name='recommendations-filter-time']:checked").val(),price:t("input[name='recommendations-filter-price']:checked").val()},r=[];return t.each(t(".recommendations-filter-what"),function(e,i){t(i).attr("checked")&&r.push(t(i).val())}),o.what=t.toJSON(r),"other"===o.when&&(o.when=t("#recommendations-filter-when-date-textbox").val()),jQuery.history.load(JSON.stringify({filter:o})),n=a.make_spinner_dialog("Filtering…","Searching for great ideas…"),a.server_call("filter_recommendations",o,i),a.log_click("Recommendations","Filter",o),!1},a.filter_by_category=function(){return a.alert("Coming soon!"),a.log_click("Recommendations","Category: Filter",{coming_soon:"true"}),!1},a.filter_where=function(){return a.alert("Coming soon!"),a.log_click("Recommendations","Filter by neighborhood",{coming_soon:"true"}),!1},a.recalc_sentence=function(e,i){a.is_page_reload=!1,void 0===i&&(i=!0),t(".filter-dropdown:visible").hide("blind"),t("#filter-sentence").children("span").children("a").removeClass("selected"),t("#filter-sentence").children("span").children("span").removeClass("selected");var o="",n=0;return t.each(t(".recommendations-filter-what:checked"),function(e,i){return 2>n?(o=o?o+" and <a class='what-a'>"+t(i).next().text()+"</a>":"<a class='what-a'>"+t(i).next().text()+"</a>",void(n+=1)):(o+="…",!1)}),o||(o="<a class='what-a'>All Results</a>"),t("#what-span").html(o),t("<span style='margin-left:3px' class='recommendations-filter-arrow what-arrow'></span>").insertAfter(t(".what-a")),t("#neighborhood-a").text(t(".recommendations-filter-neighborhood:checked").next().text()),t("#when-a").text("other"===t(".recommendations-filter-when:checked").val()?a.human_date(t("#recommendations-filter-when-date-textbox").val()):t(".recommendations-filter-when:checked").next().text()),t("#time-a").text(t(".recommendations-filter-time:checked").next().text()),t("#price-a").text(t(".recommendations-filter-price:checked").next().text()),i&&a.filter_recommendations(),e&&e.data&&e.data.ret?!1:void 0},a.human_date=function(e){var t="",i=["January","February","March","April","May","June","July","August","September","October","November","December"],o=e.split("/");return t=i[parseInt(o[0],10)-1],t=t+" "+o[1]},a.step2_bookmark=function(){{var e=t(this);e.parent()}return t(".search-result-bookmark-notforme-common",this).hasClass("search-result-bookmark")?(a.bookmark_activity(e.data("activity-id"),!0,null,"step2"),t(".search-result-bookmark-notforme-common",this).removeClass("search-result-bookmark"),t(".search-result-bookmark-notforme-common",this).addClass("search-result-bookmark-complete"),e.data("tooltip").getTip().text("You've Bookmarked This")):(a.bookmark_activity(e.data("activity-id"),!1,null,"step2"),t(".search-result-bookmark-notforme-common",this).removeClass("search-result-bookmark-complete"),t(".search-result-bookmark-notforme-common",this).addClass("search-result-bookmark"),e.data("tooltip").getTip().text("Bookmark This")),!1},a._activity_refresh_buttons=function(){3==a.activity_details_version?(a.activity_objects[a.activity_id].bookmarked?t("#add-to-bookmarks-button").addClass("selected"):t("#add-to-bookmarks-button").removeClass("selected"),a.activity_objects[a.activity_id].done_it?(t("#mark-as-done-button").addClass("selected"),t("#add-to-bookmarks-container").hide(),t("#mark-as-done-container > .button").addClass("full-width")):(t("#mark-as-done-button").removeClass("selected"),t("#add-to-bookmarks-container").show(),t("#mark-as-done-container > .button").removeClass("full-width"))):(a.activity_objects[a.activity_id].bookmarked?t(".hide-if-bookmarked:visible").hide("blind",800,function(){t(".show-if-bookmarked:hidden").show("blind",500),t("#details-share-choices:hidden").show("blind"),t("#details-share-portion").hide(),t("#details-done-area").addClass("bookmarked")}):t(".show-if-bookmarked:visible").hide("blind",500,function(){t(".hide-if-bookmarked:hidden").show("blind",800),t("#details-share-choices:visible").hide("blind"),t("#details-share-portion").show(),t("#details-done-area").removeClass("bookmarked")}),a.activity_objects[a.activity_id].done_it?(t("#details-bookmark:visible").hide("blind",500,function(){t("#details-donethis:hidden").show("blind",500)}),t("#details-bookmarked:visible").hide("blind",500,function(){t("#details-donethis:hidden").show("blind",500)}),t("#details-done-area:visible").hide("blind",500,function(){t("#details-donethis:hidden").show("blind",500)}),t("#details-share-choices:hidden").show("blind"),t("#details-share-portion").hide(),t("#details-done-area").addClass("bookmarked")):(t("#details-donethis:visible").hide("blind",500,function(){t("#details-bookmark:hidden").show("blind",500),t("#details-done-area").removeClass("bookmarked"),t("#details-done-area:hidden").show("blind",500)}),t("#details-share-choices:visible").hide("blind")))},a.send_activity_emails=function(e,i){var o=[],n=function(e){0!==e.rc&&2!=e.rc&&(t("#bookmarked-popup").dragonPopup("show"),a.alert(e.message))};i.children().each(function(e,i){o.push(t(i).data().guest)}),o.length?a.server_call("send_activity_emails",{activity_id:a.activity_id,guests:t.toJSON(o),message:e},n):a.alert("Please add some recipients to email."),a.log_click("Recommendations","Send Activity Email",{recipients:o.length,suggested_user_count:a.suggested_user_count}),a.suggested_user_count=0},a.send_activity_emails_visual=function(e,i){var o=function(e){0!==e.rc&&2!=e.rc&&(t("#bookmarked-popup").dragonPopup("show"),a.alert(e.message))};i.length?a.server_call("send_activity_emails",{activity_id:a.activity_id,guests:t.toJSON(i),message:e},o):a.alert("Please add some recipients to email."),a.log_click("Recommendations","Send Activity Email",{recipients:i.length,suggested_user_count:a.suggested_user_count}),a.suggested_user_count=0},a.load_activity_share_link=function(e,i,o){a.server_call("get_activity_share_link",{activity_id:e,user_id:i},function(e){0===e.rc&&t(o).text(e.url)})},a.close_share_popup=function(){a.log_click("Recommendations","Close Share Popup"),t("#bookmarked-popup").dragonPopup("close")},a.view_instarecs=function(){window.location=a.step1_url,a.log_view("Intro Follow","Complete",{post_intro:!1})},a.profile_flip_following=function(){var e,i;return e=t("#profile-follow-user"),e.attr("checked",!e.attr("checked")),i={user_ids:JSON.stringify([a.profile_user_id]),value:!!e.attr("checked")},a.server_call("follow_users",i,function(o){0!==o.rc?a.alert(o.message):(e.attr("checked")?t("#profile-follow:visible").fadeOut(function(){t("#profile-following:hidden").fadeIn()}):t("#profile-following:visible").fadeOut(function(){t("#profile-follow:hidden").fadeIn()}),i={user_id:a.profile_user_id,grid_type:"followers"},a.server_call("refresh_usergrid",i,function(e){0!==e.rc?a.alert(e.message):t("#profile-user-followers").fadeOut(function(){t(this).html(e.usergrid).fadeIn(),a.load_deferred_images()})}))}),a.log_click("User","Follow user",i),!1},a.follow_friend=function(e,i){var o;o={user_ids:JSON.stringify([e.data("profile-id")]),value:!!parseInt(e.data("follow"),10)},a.server_call("follow_users",o,function(t){0!==t.rc?a.alert(t.message):(e.parent().children(".follow-friend-toggle:hidden").show(),e.hide())}),a.log_click("User","Follow user",t.extend(o,{tab_name:i}))},a.follow_all_friends=function(){var e,i,o=[];t.each(t("#facebook-friends  .follow-friend-toggle:visible"),function(e,i){t(i).data("profile-id")&&(o=o.concat(t(i).data("profile-id")))}),e={user_ids:JSON.stringify(o),value:!0},a.server_call("follow_users",e,function(e){0!==e.rc?a.alert(e.message):(i=t("#facebook-friends").find(".follow-friend-toggle:visible"),t("#facebook-friends").find(".follow-friend-toggle:hidden").show(),i.hide())}),a.log_click("User","Follow all users",e)},a.init_load_more_invites=function(e,i){a.invite_page_num=0,a.invite_not_loading=!0,t(window).scroll(function(){t(window).scrollTop()>t("#invite-friends").offset().top+t("#invite-friends").height()-t(window).height()-1e3&&a.invite_not_loading&&t("#invite-friends").is(":visible")&&(a.invite_not_loading=!1,a.load_more_invites(i))}),t(".invite-button").live("click",function(){var e=t(this);a.send_invite_to_fb_user_button(e,e.data("fb-id"))})},a.load_more_invites=function(e){a.server_call("get_more_invite_friends",{page:a.invite_page_num,page_name:a.invite_page_name},function(i){0!==i.rc?1!==i.rc&&a.alert(i.message):(a.invite_page_num=a.invite_page_num+1,a.invite_not_loading=!0,t("#invite-friends").append(t(i.results_section)),e||t(".fb-friends-tab").show(),a.load_deferred_images(),a.log_view("User",a.invite_page_name+" Page - Load More",{page_num:a.invite_page_num}),t("#spinner").remove())})},a.build_fb_mesage_share_url=function(e,t,i){var i,o;return o="http://"+t.domain+"/share/?ref="+i+"&inv="+t.user_strid+"&recipient="+e},a.build_fb_message_url=function(e,t,i,o){var n,r,c,s,l,d;return d=t.user_first_name,c=a.build_fb_mesage_share_url(e,t,i),n="Click here to join "+d+" on Sosh. Discover the best events, activities, and places in your city.",r="Sosh helps you find the best date ideas, cocktail bars, underground supper clubs, scenic hikes, and more.",s="http://"+t.domain+t.redirect_url+"?inviter="+t.user_strid+"&recipient="+e+"&promoted="+o+"&tshirt="+a.tshirt_promo,l="http://www.facebook.com/dialog/send?display=popup&app_id="+t.app_id+"&name="+n+"&link="+window.escape(c)+"&to="+e+"&description="+r+"&redirect_uri="+window.escape(s)},a.send_invite_to_fb_user=function(){var e,o,n,r,c,s,l;return e=t(this).parent().parent().find("input"),o=t(this),n=e.data("selected-item"),e.removeClass("invalid"),n?n.is_member?void(e.hasClass("invalid")||(e.addClass("invalid"),e.parent().parent().children().last().text(n.value.split(" ")[0]+" is already a Sosh member"),e.parent().parent().children(".v-error").show())):(l=!1,t(".facebook-autocomplete:disabled").each(function(i,o){t(o).data("selected-item").fb_id==n.fb_id&&(e.addClass("invalid"),e.parent().parent().children().last().text("You've already sent a message to "+n.value.split(" ")[0]),e.parent().parent().children(".v-error").show(),l=!0)}),void(l||(r=window.open("about:blank","test","width=580,height=300,scrollbars=0"),c=(window.innerWidth-580)/2+window.screenLeft,s=(window.innerHeight-300)/2+window.screenTop,r.moveTo(c,s),t(this).hasClass("fb-send-button")?a.log_click("User","Send Invite",{invitee:n.fb_id}):a.log_click("User","Send Invite Grid",{invitee:n.fb_id}),i.push(["_trackSocial","facebook","invite user"]),a.server_call("get_invite_code",{fb_uid:n.fb_id},function(e){0!==e.rc?(a.alert(":( "+e.message),r.close()):(a.autocomplete_to_send=o.data("position"),r.location=a.build_fb_message_url(n.fb_id,e,"circus_invite",!1))})))):void(e.hasClass("invalid")||(e.addClass("invalid"),e.parent().parent().children(".v-error").text("You must select a Facebook friend"),e.parent().parent().children(".v-error").show()))},a.send_invite_to_fb_user_button=function(e,t){var o,n,r,c;o=window.open("about:blank","test","width=580,height=300,scrollbars=0"),n=(window.innerWidth-580)/2+window.screenLeft,r=(window.innerHeight-300)/2+window.screenTop,o.moveTo(n,r),i.push(["_trackSocial","facebook","invite user"]),a.server_call("get_invite_code",{fb_uid:t},function(i){var n=e.data("promoted");0!==i.rc?(a.alert(":( "+i.message),o.close()):(a.server_call("set_friend_invite",{fb_uid:t}),a.server_call("reset_reminder_friends_cache"),c=a.tshirt_promo?"fb_p2p_button_tshirt":"fb_p2p_button",FB.api("https://graph.facebook.com/","post",{id:a.build_fb_mesage_share_url(t,i,c),scrape:!0},function(){o.location=a.build_fb_message_url(t,i,c,n)}),a.log_click("User","Invite Friends - Invite Button",{fb_uid:t,promoted:n,existing_friends:a.existing_friends,page_name:a.invite_page_name,test_side:i.test_side,num_friends:i.extra_friends,num_bookmarks:i.num_bookmarks,recipient_gender:i.recipient_gender,tshirt_promo:a.tshirt_promo}))})},a.fb_autocomplete_dropdown=function(){var e,i=t(".facebook-autocomplete");i.attr({placeholder:"Loading…",disabled:!0}).autocomplete("destroy"),e=c.static_prefix+"/images/profile/ol_profile_no_avatar.gif",a.server_call("get_all_friends",{fb_friends_only:"false"},function(o){0!==o.rc?a.alert(":( "+o.message):i.each(function(i,n){t(n).attr({disabled:!1,placeholder:"Enter a friend's name"}).autocomplete({minLength:0,delay:0,source:o.users,focus:function(e,i){return t(this).val(i.item.value),!1},select:function(e,i){return t(this).val(i.item.value),t(this).data("selected-item",i.item),t(this).parent().find("img").attr({src:i.item.mugshot}),t(this).removeClass("invalid"),t(this).parent().parent().children(".v-error").hide(),t(this).parent().parent().find("button").animate({opacity:"0"},"fast","linear",function(){t(this).removeClass("black-button-small").addClass("blue-button-small").animate({opacity:"1"},"fast")}),!1}}).focus(function(){t(this).select().keydown()}).keyup(function(){t(this).data("selected-item")&&t(this).data("selected-item").value!=t(this).val()&&t(this).data("selected-item",null),t(this).data("selected-item")||t(this).prev().attr({src:e})}).data("autocomplete")._renderItem=function(e,i){var o,n,r,c;return c=t("<li></li>").data("item.autocomplete",i),o=i.value,n=t("<img/>").attr({src:i.mugshot}).css({width:"38px",height:"38px","float":"left","margin-right":"5px"}),r=t("<div/>").css({"font-style":"italic","font-size":"12px"}),i.is_member?r.text("(Already a Sosh member)"):i.fb_id?r.text("Facebook friend"):(n.attr("src",a.make_static_url("/images/smicons/email-24x24.png")),r.text(i.email)),c.append(t("<a/>").append(n,o," ",r)).appendTo(e),i.is_member&&c.addClass("ui-state-disabled"),c}})})},a.facebook_publish_to_feed=function(e,t,i,o,n){var a={method:"feed",link:e,picture:t,name:i,caption:o,description:n};FB.ui(a)},a.post_to_twitter=function(e,t,i,o){var n,a=(window.innerWidth-580)/2+window.screenLeft,r=(window.innerHeight-300)/2+window.screenTop;void 0===i&&(i=!1),void 0===o&&(o="sosh"),n=i?"http://twitter.com/share?url="+e+"&text="+encodeURIComponent(t)+"&related="+o:"http://twitter.com/share?url="+e+"&via="+o+"&text="+encodeURIComponent(t),window.open(n,"Toot","resizable=no,scrollbars=no,width=550,height=450,left="+a+",top="+r)},a.show_all_people=function(e,i){var o;n=a.make_spinner_dialog("Loading…","Loading users…"),a.server_call("get_all_people",{list_type:e,item_id:i},function(e){n.dragonPopup("close"),0!==e.rc?a.alert(e.message):(o=t("<div/>").addClass("userlist"),t.each(e.users,function(e,i){o.append(t("<div>").addClass("userlist-user").append(t("<img>").attr({src:i.avatar}),t("<a>").attr({href:i.link}).text(i.name)))}),o.dragonPopup({title:e.title,minWidth:250,maxWidth:500}))})},a.show_substream=function(e,i){var o;n=a.make_spinner_dialog("Loading…","Loading stream…"),a.server_call("get_substream",{stream_type:e,user_id:i},function(e){n.dragonPopup("close"),0!==e.rc?a.alert(e.message):(o=t("<div/>").addClass("module1-content").css({height:"400px","overflow-y":"auto",backgroundColor:"#fff"}).html(e.feed_html),o.dragonPopup({title:e.title,minWidth:550,maxWidth:600}),a.load_deferred_images())
})},a.show_bookmarks_popup=function(e,i){var o;n=a.make_spinner_dialog("Loading…","Loading bookmarks…"),a.server_call("get_substream",{stream_type:e,user_id:i},function(e){n.dragonPopup("close"),0!==e.rc?a.alert(e.message):(o=t("<div/>").addClass("module1-content").css({height:"400px","overflow-y":"auto",backgroundColor:"#fff"}).html(e.feed_html),o.dragonPopup({title:e.title,minWidth:550,maxWidth:600}),a.load_deferred_images())})},a.instarec_bookmark=function(e){var i=t(e.target).data("activity-id"),o={activity_id:i,value:!0,num_social_just:t(".social_justification").length,social_just:t(this).data("social-just")>0,rec_type:t(this).data("rec-type"),position:t(this).data("position"),src:"instarec",post_intro:a.post_intro},n=t("#instarec-continue").data("log-params");return a.server_call("bookmark_activity",o),a.log_click("Recommendations","InstaRec Bookmark",o),t("#instarec-activity-"+i).hide("blind",function(){t("#instarec-bookmarked-"+i).show("blind").effect("highlight")}),n.bookmarked+=1,a.num_recs_rated+=1,t("#instarec-continue").data("log-params",n),a.num_recs_rated==a.num_recs&&(t("#instarec-continue").mousedown(),t("#instarec-continue").click()),!1},a.instarec_done_it=function(e){var i=t(e.target).data("activity-id"),o={activity_id:i,rating:"done-this",value:!0,num_social_just:t(".social_justification").length,social_just:t(this).data("social-just")>0,position:t(this).data("position"),feed_story:!0,rec_type:t(this).data("rec-type"),post_intro:a.post_intro,src:"instarec"},n=t("#instarec-continue").data("log-params");return a.server_call("rate_activity",o),a.log_click("Recommendations","InstaRec Done It",o),t("#instarec-activity-"+i).hide("blind",function(){t("#instarec-done-it-"+i).show("blind").effect("highlight")}),n.notforme+=1,a.num_recs_rated+=1,t("#instarec-continue").data("log-params",n),a.num_recs_rated==a.num_recs&&(t("#instarec-continue").mousedown(),t("#instarec-continue").click()),!1},a.show_google_import_popup=function(e,t){var i=400,o=310,n=screen.width/2-i/2,a=screen.height/3-o/2;return t&&(e=e+"?next="+t),window.open(e,"googleauth","menubar=0,resizable=0,width="+i+",height="+o+",left="+n+",top="+a),!1},a.show_twitter_connect_popup=function(e,t){var i=600,o=400,n=screen.width/2-i/2,a=screen.height/3-o/2;return e=e+"?next="+t,window.open(e,"twitterauth","menubar=0,resizable=0,width="+i+",height="+o+",left="+n+",top="+a),!1},a.check_google_import_status=function(e){var t=function(t){"PENDING"==t.status?(e.text(t.count),setTimeout(a.check_google_import_status,2e3,e)):"SUCCESS"==t.status?t.count>0?(window.opener.google_import_callback(t.count),window.close()):a.alert("Ugh.  Something went wrong :("):(a.alert("An error occurred running this search. Please try again."),a.log_view("Recommendations","Search failed",{status:t.status}))};a.server_call("get_google_import_status",{},t)},a.delete_feed_story=function(){var e=t(this),i=e.parents(".feed-story,.feed-big-story,.home-friend-grid-item"),o=i.data("story-id");return t("<div/>").text("Are you sure you want to delete this story?").dragonPopup({buttons:{"Delete story":function(){a.server_call("delete_feed_story",{story_id:o},function(e){0!==e.rc?a.alert(e.message):i.hide("blind",a.load_deferred_images)}),t(this).dragonPopup("close"),a.log_click("Feed","Delete Feed Story",{story_id:o})},Cancel:function(){t(this).dragonPopup("close")}},maxWidth:800}),a.log_click("Feed","Delete link",{story_id:o}),!1},a.comment_on_feed_story=function(){var e=t(this),i=e.parents(".feed-story,.feed-big-story,.home-friend-grid-item"),o=i.data("story-id"),n=i.find(".feed-story-comment-textbox"),r=i.find(".feed-story-comment-box:hidden");return i.find(".feed-story-comment-block,.feed-big-story-comment-block").show(),r.length?(i.find("div.feed-story-tail-dark").show(),i.find("hr.feed-story-comment-line").show(),n.addClass("expanded"),r.find("button").show(),r.show(),n.focus(),a.load_deferred_images(),a.relayout_feed()):n.focus(),a.log_click("Feed","Comment link",{story_id:o}),!1},a.get_all_feed_story_comments=function(){var e=t(this),i=e.parents(".feed-story,.feed-big-story,.home-friend-grid-item"),o=i.data("story-id"),n=i.find(".feed-story-comments"),r=i.find(".feed-story-tail-dark"),c=i.data("comments_visible");return c||(i.data("comments_visible",!0),n.hide("blind",function(){a.server_call("get_all_feed_story_comments",{story_id:o},function(e){0!==e.rc?(a.alert(e.message),i.data("comments_visible",!1)):(n.html(e.comments),r.removeClass("feed-story-tail-dark").addClass("feed-story-tail")),n.show(),a.load_deferred_images(),a.relayout_feed()})}),a.log_click("Feed","See all comments",{story_id:o})),!1},a.post_feed_story_comment=function(){var e,i=t(this),o=i.parents(".feed-story,.feed-big-story,.home-friend-grid-item"),n=o.data("story-id"),r=o.find(".feed-story-comments"),c=o.find(".feed-story-comment-textbox"),s=c.val(),l=o.data("activity-id"),d={};return d.story_id=n,d.comment=s,l&&(d.activity_id=l),c.val()?(a.server_call("post_feed_story_comment",d,function(o){0!==o.rc?a.alert(o.message):(c.removeClass("expanded").val(""),i.hide(),e=t(o.comment),e.css({display:"none"}),r.append(e),e.show(),a.load_deferred_images(),a.relayout_feed())}),void a.log_click("Feed","Post comment",{story_id:n})):!1},a.delete_feed_story_comment=function(){var e=t(this),i=e.parents(".feed-story,.feed-big-story,.home-friend-grid-item"),o=i.data("story-id"),n=e.parents(".feed-story-user-comment"),r=n.data("comment-id");return t("<div/>").text("Are you sure you want to delete this comment?").dragonPopup({buttons:{"Delete comment":function(){a.server_call("delete_feed_story_comment",{story_id:o,comment_id:r},function(e){0!==e.rc?a.alert(e.message):(n.hide("blind"),a.load_deferred_images())}),t(this).dragonPopup("close"),a.log_click("Feed","Delete Comment",{story_id:o,comment_id:r})},Cancel:function(){t(this).dragonPopup("close")}},maxWidth:800}),a.log_click("Feed","Delete Comment link",{story_id:o,comment_id:r}),!1},a.comment_textbox_got_focus=function(){var e=t(this),i=e.siblings("div:hidden");e.addClass("expanded"),i.show(),a.load_deferred_images(),a.relayout_feed()},a.comment_textbox_lost_focus=function(){var e=t(this),i=e.siblings("div:visible");e.val()||(t(this).removeClass("expanded"),i.hide(),a.load_deferred_images(),a.relayout_feed())},a.fetch_searchresults=function(){var e=t("#search-field"),i=a.search_term,o=function(e){var o;n.dragonPopup("close"),0!==e.rc?a.alert(e.message):(o=t(e.results_section),a.log_search_results(i,{num_results:e.num_results,num_cats:0,num_activities:e.num_results,num_users:0,search_type:"Full Search",activity_ids:e.activity_ids}),t("#recommendation-results").html(o),t("#recommendation-results").show("blind"),a.results_log_summary_view(0),t("div.ratings-box").show(),a.load_deferred_images())};return e.blur(),t("#recommendation-results").hide("blind"),n=a.make_spinner_dialog("Searching…","Searching for activities matching your query…"),a.server_call("search",{term:i},o),!1},a.get_more_searchresults=function(){var e,i=t(this),o=(t("#search-field"),a.search_term),r=function(o){var r;n.dragonPopup("close"),0!==o.rc?a.alert(o.message):(r=t(o.results_section),t("#step2-other-activities").append(t("<hr>"),r),a.results_log_summary_view(o.first_position),a.load_deferred_images(),o.is_more?i.data("page",e+1):i.hide("blind"))};return e=i.data("page"),n=a.make_spinner_dialog("Searching…","Fetching more results…"),a.log_click("Search","See more results button",{query:o}),a.server_call("get_more_searchresults",{page:e,term:o},r),!1},a.pretty_encodeURI=function(e){var t;return t=encodeURIComponent(e),t.replace(/%20/g,"+")},a.pretty_decodeURI=function(e){var t;return t=e.replace(/\+/g,"%20"),decodeURIComponent(t)},a.validate_phone_number=function(e,t){return e=e.replace(/\s+/g,""),this.optional(t)||e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},jQuery.validator.addMethod("phoneUS",a.validate_phone_number,"Please specify a valid phone number"),a.showFeedback=function(e,i,o){var n,r,c,s,l,d,u,_,p;return n=t("<div />"),o?(s=[t("<option>").attr("value",0).text("Venue Closed"),t("<option>").attr("value",1).text("Discontinued Item/Service"),t("<option>").attr("value",2).text("Wrong Activity Dates"),t("<option>").attr("value",3).text("Wrong Activity Venue Hours"),t("<option>").attr("value",4).text("Wrong Activity Location"),t("<option>").attr("value",5).text("Broken Url"),t("<option>").attr("value",6).text("Other"),t("<option>").attr("value",7).text("Editorial Error")],d="Report a Problem",p="Error Type",u="Anymore?",_="Optional"):(s=[t("<option>").attr("value","Suggestion").text("Suggestion"),t("<option>").attr("value","Problem").text("Problem"),t("<option>").attr("value","Compliment").text("Compliment"),t("<option>").attr("value","Other").text("Other…")],d="Share Your Feedback",p="Type",u="Feedback",_="Type your feedback here…"),n=n.append(t("<form>").addClass("simple-form").append(t("<div>").addClass("clear").append(t("<label>").text(p),r=t("<select>").css({height:"28px","margin-bottom":"5px"}).append(s)),t("<div>").addClass("clear").append(t("<label>").text(u),c=t("<textarea>").attr({placeholder:_}).css({height:"100px"})))),e&&t(r.children()[e]).attr("selected","selected"),l=function(){var t={};return t.feedback=c.val(),t.feedback||o?(t.feedback_type=r.val(),t.activity_problem=1==e,t.user_agent=navigator.userAgent,t.page_url=window.location.href,t.is_content_error=o?1:0,a.server_call("submit_feedback",t,function(e){0!==e.rc?a.alert(e.message):(a.alert("Thanks for taking the time to give us feedback. We'll get back to you soon!"),n.dragonPopup("close"))}),a.log_click("User","Feedback submitted",{feedback_type:t.feedback_type}),!1):(n.dragonPopup("close"),!1)},n.dragonPopup({title:d,buttons:{Send:l},minWidth:"400px"}),r.selectBox({menuTransition:"slide",menuSpeed:"fast"}),a.log_view("User","Feedback dialog"),!1},a.get_more_collection=function(){var e=t(this),i=e.data("lastTimestamp"),o=e.data("item-offset"),n=function(i){var n;a.fetching_feed=!1,0!==i.rc?a.alert(i.message):(n=t(i.feed_items),t("#step2-other-activities").append(n),a.load_deferred_images(),a.collection_log_summary_view(o),i.is_more?(e.data("lastTimestamp",i.last_item_time),e.data("item-offset",o+i.returned_count)):e.remove())};return a.fetching_feed||(a.fetching_feed=!0,a.log_click("User","Profile feed More",{last_timestamp:i}),a.server_call("get_more_collection",{collection_id:a.collection_id,last_timestamp:i,item_offset:o},n)),!1},a.setup_homepage_category_titles=function(){t(".home-category").each(function(){var e=t(".home-category-overlay-top-title",t(this)),i=e.css("color");e.data("color",i)}),t(".home-category").hoverIntent(function(){var e=t(".home-category-overlay-top-title",t(this));e.css("color","#fff")},function(){var e=t(".home-category-overlay-top-title",t(this)),i=e.data("color");e.css("color",i)})},a.check_facebook_perms=function(){t("#facebook-button-bookmarked > input").is(":checked")&&a.facebook_perms_granted?1===a.facebook_perms_granted.publish_actions?a.action_params.callback(a.action_params.button,a.action_params.page):(0!==FB.getUserID()&&a.fb_uid!=FB.getUserID()&&FB.logout(),a.facebook_extended_perms_popup()):a.action_params.callback(a.action_params.button,a.action_params.page)},a.facebook_extended_perms_popup=function(){a.fb_dr_popup=t(a.facebook_perms_popup).dragonPopup({title:"Sosh needs your permission to post on Facebook",minWidth:800,maxWidth:800,onClose:function(){t("#fb-perms-popup").parents(".overlay").remove()}})},a.fb_button_callback=function(){FB.api("/me/permissions",function(e){e.error&&2500==e.error.code?a.log_click("User","Verify Facebook Perms",{error:"Inactive Token"}):e.data&&(1==e.data[0].publish_actions||1==e.data[0].publish_stream?(a.log_click("User","Verify Facebook Perms",{perms:"granted_perms"}),a.facebook_perms_complete()):(a.log_click("User","Verify Facebook Perms",{perms:"granting_error"}),a.button_spinner_reset(t("#status-div").parent().find(".blue-button-medlrg"))),a.fb_dr_popup&&a.fb_dr_popup.dragonPopup("close"))})},a.facebook_perms_complete=function(){a.action_params&&a.action_params.callback(a.action_params.button,a.action_params.page),a.facebook_perms_granted=t.extend(a.facebook_perms_granted,{publish_actions:1}),a.server_call("set_facebook_perms")},a.fb_connect=function(e){var t=function(t){1===t.rc?(c.log_event("Signup","FB Connect","Succeeded - Existing user"),window.location=e?e:t.url):2===t.rc?c.log_event("Signup","FB Connect","Failed"):3===t.rc||t.in_right_city===!1?(c.log_event("Signup","FB Connect","Succeeded - Creating new user"),c.log_view("Signup","Verify Location Dialog",{location:t.location})):4===t.rc||0===t.rc&&c.log_event("Signup","FB Connect","Succeeded - Creating new user")};c.server_call("signup/facebook_connect",{},t)},a.activity_social_share=function(e,t){var o={},n=[];return o.activity_id=a.activity_id,o.action_type=t,o.message=e,a.activity_objects[a.activity_id].existing_collections.length&&(o.collection_id=a.activity_objects[a.activity_id].existing_collections[0]),n=jQuery.grep(a.activity_objects[a.activity_id].existing_collections,function(e){return e!=a.magic_collections[0]&&e!=a.magic_collections[1]}),o.collection_id=n.length>0?n[Math.floor(Math.random()*n.length)]:a.activity_objects[a.activity_id].existing_collections[0],a.server_call("social_share",o,function(e){0!==e.rc||(i.push(["_trackSocial","facebook","activity share"]),o.fb_share_type=e.fb_share_type,a.log_click("Recommendations","Social Share",o))}),!1},a.setup_facebook_overlay=function(e){a.show_fb_timeline_overlay=!1,a.server_call("get_facebook_timeline_overlay",{},function(i){0!==i.rc||(i.fb_uid!=FB.getUserID()&&FB.logout(),e.append(i.facebook_overlay),a.show_fb_timeline_overlay=!0,a.user_gender=i.gender,t("#facebook-overlay-no-thanks").click(function(){a.log_click("Facebook Timeline Overlay","No Thanks",{activity_id:a.activity_id,facebook_share_enabled:t("#facebook-button-bookmarked > input").is(":checked"),gender:a.user_gender}),e.dragonPopup("close")}),t("#facebook-overlay-add-button").click(function(){t(".facebook-overlay-button-section").hide(),t(".facebook-overlay-button-section-dynamic").show(),t("<img/>").attr({src:a.make_static_url("/images/ajax-loader-small.gif")}).appendTo(t(".facebook-overlay-button-section-dynamic")),FB.login(function(i){i.authResponse?FB.api("/me/permissions",function(i){1==i.data[0].publish_actions?(a.log_click("User","Verify Facebook Perms",{perms:"granted_perms"}),a.server_call("set_facebook_timeline",{},function(){}),setTimeout(function(){t(".facebook-overlay-button-section-dynamic").empty(),t(".facebook-overlay-button-section-dynamic").text("Success!").append(t("<div class='share-tab-icon-tick'/>")),setTimeout(function(){e.dragonPopup("close")},2e3)},1e3)):(a.log_click("User","Verify Facebook Perms",{perms:"granting_error"}),t(".facebook-overlay-button-section").show(),t(".facebook-overlay-button-section-dynamic").empty().hide())}):(t(".facebook-overlay-button-section").show(),t(".facebook-overlay-button-section-dynamic").empty().hide())},{scope:"publish_actions"}),a.log_click("Facebook Timeline Overlay","Add Facebook to Profile",{activity_id:a.activity_id,facebook_share_enabled:t("#facebook-button-bookmarked > input").is(":checked"),gender:a.user_gender})}))})},a.show_facebook_overlay=function(){a.server_call("ue_increment",{what_to_increment:"facebook_timeline_overlay_views"}),a.button_spinner_end(!1),setTimeout(function(){t("#status-div").hide(),t(".facebook-timeline-overlay").slideDown(1e3)},1e3),a.log_view("Facebook Timeline Overlay","",{activity_id:a.activity_id,facebook_share_enabled:t("#facebook-button-bookmarked > input").is(":checked"),gender:a.user_gender})},a.show_bookmark_popup=function(e,i){var o;a.pane_name="Bookmark",o=t(e).dragonPopup({minWidth:580,maxWidth:580,onClose:function(){t(".selectBox-dropdown-menu").remove(),t(".overlay").remove(),a.clean_up_visual_friend_selector(),a.show_fb_timeline_overlay=!1}}),a.initialize_select_box(a.REMOVE_DONE_COLLECTION),t("#cancel").click(function(){o.dragonPopup("close")}),a.common_popup_init(),t("#bookmark-it").click(function(){a.action_params={button:t(this),page:i,callback:a.bookmark_add_to_collections},a.check_facebook_perms()}),a.log_view("Recommendations","Cinematic Popup",{activity_id:a.activity_id,pane:a.pane_name,bookmarked:a.activity_objects[a.activity_id].bookmarked,fb_share_on:!!t("#fb-check").attr("checked")})},a.bookmark_add_to_collections=function(e,i){var o,n,r,c=[],s=!1;return t("#fancy-select-box > .dragon-dropdown input[type=checkbox]:checked").each(function(){c.push(parseInt(t(this).val(),10))}),a.activity_objects[a.activity_id].bookmarked||0!==c.length?(a.activity_objects[a.activity_id].existing_collections=c,a.activity_objects[a.activity_id].collection_item_note=t("#share-note").val(),o={action_text:"bookmarked",activity_id:a.activity_id,collection_ids:JSON.stringify(c),src:i,value:!a.activity_objects[a.activity_id].bookmarked,story_id:a.feed_story_id},o.message=t("#share-note").val()==t("#share-note").attr("placeholder")?"":t("#share-note").val(),n=t.getQueryParam("ref"),n&&(o.ref=n),a.feed_story_id=null,a.server_call("add_collections",o,function(e){0!==e.rc?a.alert(e.message):a.refresh_user_grid({grid_type:"bookmarked",activity_id:a.activity_id},"#details-right-bookmarked-by")},"activity_details"),r="",r=1==c.length?" collection)":" collections)",t("#details-bookmark-remove").text("("+c.length+r),t("#facebook-button-bookmarked > input").is(":checked")&&!a.activity_objects[a.activity_id].bookmarked?a.button_spinner_start(e,"Posting to Facebook…"):a.button_spinner_start(e,"Saving Bookmark…"),t("#cancel").css("display","none"),c.length>0?(a.activity_objects[a.activity_id].bookmarked||(a.bookmark_commit(),t("#facebook-button-bookmarked > input").is(":checked")&&a.activity_social_share(o.message,"bookmark")),a.v_friends_selected&&a.v_friends_selected.length>0&&a.send_activity_emails_visual(t("#share-note").val(),a.v_friends_selected)):a.bookmark_commit(),a._activity_refresh_buttons(),setTimeout(function(){a.show_fb_timeline_overlay?a.show_facebook_overlay():a.button_spinner_end(!0)},1e3),a.bookmark_callback&&a.bookmark_callback(),(-1!=t.inArray(a.magic_collections[0],a.activity_objects[a.activity_id].existing_collections)||-1!=t.inArray(a.magic_collections[1],a.activity_objects[a.activity_id].existing_collections))&&(s=!0),a.log_click("Recommendations","Bookmark This",t.extend(o,{num_collections:a.all_collections.length,num_selected:a.activity_objects[a.activity_id].existing_collections.length,magic_collection:s})),!1):(a.alert("You must select at least one collection."),!1)},a.bookmark_commit=function(){a.activity_objects[a.activity_id].bookmarked=a.activity_objects[a.activity_id].bookmarked?!1:!0},a.bookmark_undo=function(){var e={action_text:"bookmarked",activity_id:a.activity_id,grid_type:"bookmarked",value:!1,collection_ids:JSON.stringify([]),message:"",src:"activity_details"};a.activity_objects[a.activity_id].existing_collections=[],a.activity_objects[a.activity_id].collection_item_note="",a.activity_objects[a.activity_id].bookmarked=!1,a.server_call("add_collections",e,function(t){0!==t.rc&&a.alert(t.message),a.refresh_user_grid(e,"#details-right-bookmarked-by")},"activity_details"),a._activity_refresh_buttons()},a.show_done_it_popup=function(e,i){var o;a.pane_name="Done It",o=t(e).dragonPopup({minWidth:580,maxWidth:580,onClose:function(){t(".selectBox-dropdown-menu").remove(),t(".overlay").remove()}}),t("#cancel").click(function(){o.dragonPopup("close")}),a.common_popup_init(),o.find("#donethis-rating").selectBox({menuTransition:"slide",menuSpeed:"fast"}),o.find("#donethis-rating").selectBox("value",a.activity_objects[a.activity_id].existing_action),o.find("#done-it").click(function(){a.action_params={button:t(this),page:i,callback:a.done_it_add_to_collections},a.check_facebook_perms()}),a.activity_objects[a.activity_id].done_it&&o.find(".add-tip-text").val(a.activity_objects[a.activity_id].collection_item_note),a.log_view("Recommendations","Cinematic Popup",{activity_id:a.activity_id,pane:a.pane_name,bookmarked:a.activity_objects[a.activity_id].bookmarked})},a.done_it_add_to_collections=function(e){var i,o,n=[],r=!1,c="";return t("#fancy-select-box > .dragon-dropdown input[type=checkbox]:checked").each(function(){n.push(parseInt(t(this).val(),10))}),a.activity_objects[a.activity_id].done_it||0!==n.length?(a.activity_objects[a.activity_id].existing_collections=n,a.activity_objects[a.activity_id].collection_item_note=t("#done-it-pane .add-tip-text").val(),a.activity_objects[a.activity_id].existing_action=t("#donethis-rating").val(),i={activity_id:a.activity_id,grid_type:"loved",action_text:t("#donethis-rating").val(),value:!a.activity_objects[a.activity_id].done_it,collection_ids:JSON.stringify(n),bookmarked:a.activity_objects[a.activity_id].bookmarked,src:"Activity Details"},i.message=t("#done-it-pane .add-tip-text").val()==t("#done-it-pane .add-tip-text").attr("placeholder")?"":t("#done-it-pane .add-tip-text").val(),o=t.getQueryParam("ref"),o&&(i.ref=o),a.activity_submit_tip_helper(!1,"loved-it"==i.rating,i.message,!1),a.server_call("add_collections",i,function(e){0!==e.rc?a.alert(e.message):(a.refresh_user_grid(i,"#details-right-loved-by"),i.bookmarked&&a.refresh_user_grid({activity_id:a.activity_id,grid_type:"bookmarked"},"#details-right-bookmarked-by"))},"activity_details"),c=1==n.length?" collection)":" collections)",t("#details-donethis-remove").text("("+n.length+c),t("#facebook-button-bookmarked > input").is(":checked")&&!a.activity_objects[a.activity_id].done_it?a.button_spinner_start(e,"Posting to Facebook…"):a.button_spinner_start(e,"Saving…"),t("#cancel").css("display","none"),n.length>0?a.activity_objects[a.activity_id].done_it||(a.done_it_commit(),t("#facebook-button-bookmarked > input").is(":checked")&&a.activity_social_share(i.message,"done")):a.done_it_commit(),a._activity_refresh_buttons(),setTimeout(function(){a.button_spinner_end(!0)},1e3),a.done_callback&&a.done_callback(),(-1!=t.inArray(a.magic_collections[0],a.activity_objects[a.activity_id].existing_collections)||-1!=t.inArray(a.magic_collections[1],a.activity_objects[a.activity_id].existing_collections))&&(r=!0),a.log_click("Recommendations","Done This",t.extend(i,{num_collections:a.all_collections.length,num_selected:a.activity_objects[a.activity_id].existing_collections.length,magic_collection:r})),!1):(a.alert("You must select at least one collection."),!1)},a.done_it_commit=function(){a.activity_objects[a.activity_id].done_it?(a.activity_objects[a.activity_id].done_it=!1,a.activity_objects[a.activity_id].bookmarked=!1):a.activity_objects[a.activity_id].done_it=!0},a.done_it_undo=function(){var e={activity_id:a.activity_id,action_text:"done-this",value:!1,collection_ids:JSON.stringify([]),message:"",src:"Activity Details"};a.activity_objects[a.activity_id].existing_collections=[],a.activity_objects[a.activity_id].collection_item_note="",a.activity_objects[a.activity_id].bookmarked=!1,a.activity_objects[a.activity_id].done_it=!1,a.server_call("add_collections",e,function(e){0!==e.rc&&a.alert(e.message)},"activity_details"),a._activity_refresh_buttons()},a.show_facebook_share_popup=function(e,i,o){a.pane_name="share-facebook-ad"==o?"Post Bookmark - Facebook":"Pre Bookmark - Facebook";var n=t(e).dragonPopup({minWidth:580,maxWidth:580,onClose:function(){t(".overlay").remove()}});n.find("#post-to-facebook").click(function(){var e=t(this);a.action_params={button:e,page:i,callback:function(){a.button_spinner_start(e,"Posting to Facebook…"),setTimeout(function(){a.button_spinner_end(!0)},1e3),a.activity_social_share(n.find("#bookmarked-social-message").val(),"facebook_popup")}},a.check_facebook_perms(),"share-facebook-ad"==o?a.log_click("Recommendations","Post Bookmark Share - Facebook",{activity_id:a.activity_id}):a.log_click("Recommendations","Pre Bookmark Share - Facebook",{activity_id:a.activity_id})}),a.common_popup_init(),a.log_view("Recommendations","Cinematic Popup",{activity_id:a.activity_id,pane:a.pane_name,bookmarked:a.activity_objects[a.activity_id].bookmarked})},a.show_twitter_share_popup=function(e,i){a.pane_name="share-twitter-ad"==i?"Post Bookmark - Twitter":"Pre Bookmark - Twitter";var o=t(e).dragonPopup({minWidth:580,maxWidth:580,onClose:function(){t(".overlay").remove()}}),n=115;o.find("#bookmarked-social-message").keyup(function(){var e=n-this.value.length;t("#char-count").html(e.toString()+" characters left"),0>e?t("#char-count").css("color","red"):t("#char-count").css("color","black")}),o.find("#post-to-twitter").click(function(){{var e;t(this)}if(e=n-t("#bookmarked-social-message").val().length,0>e)a.alert("Too many characters! You must delete "+(-1*e).toString()+" characters before submitting.");else{if(!a.is_twitter_user)return void a.twitter_authenticate_alert("Please connect your Twitter account so we can post your tweet.");a.button_spinner_start(o.find("#post-to-twitter"),"Posting…"),a.server_call("post_tweet",{activity_id:a.activity_id,tweet:t("#bookmarked-social-message").val()},function(e){0!==e.rc?(a.button_spinner_reset(o.find("#post-to-twitter")),a.twitter_authenticate_alert("We were unable to post your tweet. Please reconnect your Twitter account.")):setTimeout(function(){a.button_spinner_end(!0)},2e3)})}"share-twitter-ad"==i?a.log_click("Recommendations","Post Bookmark Share - Twitter",{activity_id:a.activity_id}):a.log_click("Recommendations","Pre Bookmark Share - Twitter",{activity_id:a.activity_id})}),a.common_popup_init(),a.log_view("Recommendations","Cinematic Popup",{activity_id:a.activity_id,pane:a.pane_name,bookmarked:a.activity_objects[a.activity_id].bookmarked})},a.show_email_share_popup=function(e,i){var o;a.pane_name="share-email-ad"==i?"Post Bookmark - Email":"Pre Bookmark - Email",a.v_friends_selected=[],o=t(e).dragonPopup({minWidth:750,maxWidth:750,onClose:function(){t(".overlay").remove(),a.clean_up_visual_friend_selector()}}),a.initialize_visual_friend_selector(),o.find("#bookmarked-popup-email").easySlider({prevId:"select-friends-done-hidden",nextId:"select-friends-hidden",speed:500}),t("#bookmarked-popup-email").css({height:"100%"}),o.find("#select-friends-done-hidden").hide(),o.find("#select-friends-hidden").hide(),o.find("#select-friends").click(function(){o.find("#select-friends-hidden > a").click(),a.log_click("Recommendations","Email Popup - Select Friends")}),o.find("#add-more-friends").click(function(){o.find("#select-friends-hidden > a").click()}),o.find("#select-friends-done, #select-friends-back").click(function(){t(this);a.process_selected(),a.done_with_selection(o,a.prev_pane_calc_friends),"share-email-ad"==i?a.log_click("Recommendations","Post Bookmark Share - Email",{activity_id:a.activity_id}):a.log_click("Recommendations","Pre Bookmark Share - Email",{activity_id:a.activity_id})}),o.find("#send-it").click(function(){a.v_friends_selected&&a.v_friends_selected.length>0?(a.send_activity_emails_visual(o.find("#bookmarked-email-message").val(),a.v_friends_selected),a.button_spinner_start(o.find("#send-it"),"Sending Email…"),setTimeout(function(){a.button_spinner_end(!0)},2e3)):t("#no-friends-help").fadeIn(function(){setTimeout(function(){t("#no-friends-help").fadeOut()},2e3)})}),a.log_view("Recommendations","Cinematic Popup",{activity_id:a.activity_id,pane:a.pane_name,bookmarked:a.activity_objects[a.activity_id].bookmarked})},a.add_tip_popup=function(e,i){a.pane_name="Add Tip";var o=t(e).dragonPopup({minWidth:750,maxWidth:750,onClose:function(){t(".overlay").remove()}});o.find("#add-a-tip").click(function(){a.action_params={button:t(this),page:i,callback:function(){a.activity_submit_tip_helper(!0,!1,t(".dragon-popup-wrapper").find(".add-tip-text").val(),!0)}},a.check_facebook_perms()}),o.find(".add-tip-type").selectBox({menuTransition:"slide",menuSpeed:"fast"}),a.common_popup_init(),a.log_view("Recommendations","Cinematic Popup",{activity_id:a.activity_id,pane:a.pane_name,bookmarked:a.activity_objects[a.activity_id].bookmarked})},a.activity_submit_tip_helper=function(e,i,o,n){n&&(t("#facebook-button-bookmarked > input").is(":checked")?(a.activity_social_share(t(".add-tip-text").val(),"tip"),a.button_spinner_start(a.action_params.button,"Posting to Facebook…")):a.button_spinner_start(a.action_params.button,"Saving Bookmark…"),setTimeout(function(){a.button_spinner_end(!0)},1e3)),o&&(a.server_call("add_tip",{activity_id:a.activity_id,tip:o,feed_story:e,is_loved:i}),a.tip_callback&&a.tip_callback(o),a.log_click("Recommendations","Add Tip",{activity_id:a.activity_id,tip_text:o}))},a.setup_cinematic_popup_data=function(e){return a.activity_id=parseInt(e.data("activity-id"),10),a.activity_objects[a.activity_id]},a.common_popup_init=function(){t("#fb-check").click(function(){t(this).attr("checked")?t(this).parent("#facebook-button-bookmarked").addClass("active"):t(this).parent("#facebook-button-bookmarked").removeClass("active"),a.log_click("Recommendations","Facebook Toggle",{activity_id:a.activity_id,facebook_share:!!t(this).attr("checked")})})},a.initialize_select_box=function(e){var i,o,n,r=t("#fancy-select-box > .dragon-dropdown"),c=t("#fancy-select-box > .dragon-selectbox");o=function(){function i(e,i){var o,n,a,r;return o=t(e).find("input").prop("checked"),n=t(i).find("input").prop("checked"),a=t(e).find("label").text(),r=t(i).find("label").text(),o>n?-1:n>o?1:r>a?-1:a>r?1:0}var o=!1,r=[],c=!1;(0===a.activity_objects[a.activity_id].existing_collections.length||"Done It"==a.pane_name&&a.activity_objects[a.activity_id].done_it===!1)&&(c=!0),t(a.all_collections).each(function(i,s){s.type!=e&&(o=-1!=t.inArray(s.val,a.activity_objects[a.activity_id].existing_collections)||c===!0&&(1===s.type||2===s.type)?!0:!1,r=r.concat(n(s.val,s.option,o)))}),r.sort(i),t("#fancy-select-box .dropdown-top").append(r.join(""))},n=function(e,i,o){var n,a,r;return n=t("<input>").attr("type","checkbox").attr("id",e).attr("value",e).attr("name",e).attr("checked",o),a=t("<label>").attr("for",e).addClass("ellipsis").addClass("collection").css({"margin-left":"5px",display:"inline-block",width:"190px"}).text(i),r=t("<div class='collection-checkboxes'>").append(n,a),r=t("<div>").append(r),r.html()},i=function(){var e=r.find("input[type=checkbox]:checked").length;c.text(1==e?r.find("input[type=checkbox]:checked").siblings().text():e+" Collections..."),t(".add-collection-fields").hide(),t("#create-new-collection").show()},o(),i(),t("#create-new-collection").click(function(){return a.saved_hash=window.location.hash,t(this).hide(),t(".add-collection-fields").show(),a.log_click("Cinematic Popup","Collections Dropdown - Create New",{activity_id:a.activity_id,num_collections:a.all_collections.length,pane:a.pane_name}),!1}),t(".dragon-dropdown").click(function(){t(".add-collection-fields").hide(),t("#create-new-collection").show(),t(".collection-name-error").hide()}),t("#new-collection-name").click(function(e){e.stopImmediatePropagation()}),t("#add-new-collection").click(function(e){e.stopImmediatePropagation();var i,o=t("#new-collection-name").val(),r=!1;return o=t.trim(o).toProperCase().replace(/ Sf$/g," SF").replace(/^Sf /g,"SF ").replace(/ Sf /g," SF ").replace(/ Nyc$/g," NYC").replace(/^Nyc /g,"NYC ").replace(/ Nyc /g," NYC ").replace(/ Ny$/g," NY").replace(/^Ny /g,"NY ").replace(/ Ny /g," NY "),t("#new-collection-name").val(o),t(".collection-name-error").text(""),o.length<3?(t(".collection-name-error").text("That name's too short."),t(".collection-name-error").show(),void a.log_click("Cinematic Popup","Collections Dropdown - Add New Collection",{error:!0,message:"Collection name too short",pane:a.pane_name})):o.length>30?(t(".collection-name-error").text("That name's too long."),t(".collection-name-error").show(),void a.log_click("Cinematic Popup","Collections Dropdown - Add New Collection",{error:!0,message:"Collection name too long",pane:a.pane_name})):(t.each(a.all_collections,function(e,t){return o.toLowerCase()==t.option.toLowerCase()?void(r=!0):void 0}),r===!0?(t(".collection-name-error").text("You already have a collection with that name."),void t(".collection-name-error").show()):(t("#new-collection-name").css({"border-color":"#BDBDBD"}),i={name:o},a.server_call("add_new_collection",i,function(e){0===e.rc?(t(".add-collection-fields").hide(),t("#create-new-collection").show(),t("#fancy-select-box .dropdown-top").append(n(e.c_id,o,!0)),a.all_collections.push({val:e.c_id,option:o}),t("#new-collection-name").val(""),t(".collection-name-error").hide(),t("#fancy-select-box .dropdown-top").scrollTop(t("#fancy-select-box .dropdown-top")[0].scrollHeight-t("#fancy-select-box .dropdown-top").scrollTop())):(a.alert("An error occured. Please try again."),a.log_click("Cinematic Popup","Collections Dropdown - Add New Collection",{error:!0,message:"Server Error",pane:a.pane_name}))
}),a.log_click("Cinematic Popup","Collections Dropdown - Add New Collection",{activity_id:a.activity_id,num_collections:a.all_collections.length,pane:a.pane_name,col_name:o}),!1))}),r.find(".add-button").click(function(){r.slideUp("fast",i),c.removeClass("opened"),a.log_click("Cinematic Popup","Collections Dropdown - Add Button",{activity_id:a.activity_id,num_collections:a.all_collections.length,num_selected:r.find("input[type=checkbox]:checked").length,pane:a.pane_name})}),r.find("input[type=checkbox]").click(function(){a.log_click("Cinematic Popup","Collections Dropdown - Checkbox",{activity_id:a.activity_id,num_collections:a.all_collections.length,num_selected:r.find("input[type=checkbox]:checked").length,checked:t(this).is(":checked"),pane:a.pane_name})}),c.click(function(e){return r.is(":hidden")?(r.slideDown("fast"),c.addClass("opened"),a.log_click("Cinematic Popup","Collections Dropdown - Open",{activity_id:a.activity_id,num_collections:a.all_collections.length,pane:a.pane_name})):(r.slideUp("fast",i),c.removeClass("opened"),a.log_click("Cinematic Popup","Collections Dropdown - Close",{activity_id:a.activity_id,num_collections:a.all_collections.length,num_selected:r.find("input[type=checkbox]:checked").length,pane:a.pane_name})),e.stopPropagation(),!1}),r.click(function(e){e.stopPropagation()}),t(document).click(function(){r.is(":visible")&&(r.slideUp("fast",i),c.removeClass("opened"))})},a.initialize_visual_friend_selector=function(){var e,i,o,n,r;a.v_friends_selected=[],t.expr[":"].Contains=function(e,t,i){return(e.textContent||e.innerText||"").toUpperCase().indexOf(i[3].toUpperCase())>=0},t("#friend-selector-placeholder").replaceWith(Mustache.to_html(a.popup_templates.friend_selector_pane)),a.server_call("get_friends_visual_selector",function(e){a.friend_data=e.users_array,a.friend_data_dict=e.users_dict,o(a.friend_data),a.load_deferred_images(),t(".friend-item-suggested").tooltip({position:"top center",opacity:.9,offset:[80,0],predelay:500}),a.suggested_user_count=e.suggested_count}),t(".friend-item").live("click",function(){var e,o=t(this);t(".added-friend").removeClass("selected"),t("#friend-filter-input").focus(),o.hasClass("selected")?(o.removeClass("selected"),t("#"+o.data("token-id")).remove(),o.data("token-id",""),e=o.attr("id").split("-")[1],t("#grid-"+a.friend_data_dict[e].suggested_link).removeClass("selected"),a.log_click("Visual Friend Selector","Friend Deselected")):i(o,"click")}),t("#friend-selector-grid").scroll(function(){var e,i,o,n=t(this);e=4*Math.round(n.scrollTop()/54),o=e+16,e>8&&(e-=8),i=t(".friend-item > img").slice(e,o),i.addClass("deferred"),a.load_deferred_images()}),t("#friend-filter-input").keyup(function(n){var r,c,s,l=n.which,d=t(this).val(),u=(t(".friend-item"),new RegExp("\\b"+d,"i"));13==l?""!==t("#friend-filter-input").val()&&(r=t(".friend-item:visible").first().not(".selected"),r.length>0&&(i(r,"enter"),t("#friend-filter-input").val(""),o(a.friend_data))):8==l&&""===d&&(c=t("#filter-div").children("span").last(),c.hasClass("selected")?(t("#"+c.data("grid-id")).removeClass("selected"),c.remove()):c.addClass("selected")),13!=l&&e(function(){8!=l&&t("#filter-div").children("span").last().removeClass("selected"),d?(s=t.grep(a.friend_data,function(e){return-1!=e.value.search(u)&&!e.suggested}),a.log_click("Visual Friend Selector","Grid Reset",{filter:d,visible_faces:s.length}),o(s)):(o(a.friend_data),t(".friend-item-suggested").tooltip({position:"top center",opacity:.9,offset:[-10,0]}))},200)}),e=function(){var e=0;return function(t,i){clearTimeout(e),e=setTimeout(t,i)}}(),t("#filter-div").click(function(){t("#friend-filter-input").focus()}),t(".token-close").live("click",function(){var e,i=t(this);t("#"+i.parent().data("grid-id")).removeClass("selected"),i.parent().remove(),e=i.parent().attr("id").split("-")[1],t("#grid-"+a.friend_data_dict[e].suggested_link).removeClass("selected"),a.log_click("Visual Friend Selector","Token X")}),o=function(e){var i;i=Mustache.to_html(a.popup_templates.friend_selector_content_pane,{users:e,no_avatar:a.no_avatar_image}),t("#friend-selector-grid").empty(),t("#friend-selector-grid").append(t(i)),t("#friend-selector-grid").scroll(),n(),1==e.length?(t("#friend-selector-enter-message:hidden").text("Press 'Enter' to select "+e[0].value.split(" ")[0]),t("#friend-selector-enter-message:hidden").show()):t("#friend-selector-enter-message:visible").hide()},i=function(e,i){var n,r=e.attr("id").split("-")[1],c=a.friend_data_dict[parseInt(r,10)];a.log_click("Visual Friend Selector","Friend Selected",{selected_by:i,filter:t("#friend-filter-input").val(),visible_faces:t(".friend-item").length,is_member:c.is_member,have_email:c.have_email,suggested:c.suggested}),e.addClass("selected"),e.data("token-id","token-"+r),t("#grid-"+a.friend_data_dict[r].suggested_link).addClass("selected"),t("#grid-"+a.friend_data_dict[r].suggested_link).data("token-id","token-"+r),n=t("<span/>"),n.addClass("added-friend"),n.text(e.find("div").text()),n.append("<div class='token-close'>x</div>"),n.attr("id","token-"+r),n.data("grid-id",e.attr("id")),t("#friend-filter-input").before(n),""!==t("#friend-filter-input").val()&&(t("#friend-filter-input").val(""),o(a.friend_data)),t("#friend-filter-input").width("120"),t("#friend-filter-input").attr("placeholder","")},n=function(){var e,i;t.each(t("#filter-div > .added-friend"),function(o,n){e=t("#"+t(n).data("grid-id")),e.addClass("selected"),e.data("token-id",t(n).attr("id")),i=t(n).attr("id").split("-")[1],t("#grid-"+a.friend_data_dict[i].suggested_link).addClass("selected")})},r=function(e,i){var o=new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);return o.test(e.val())?!0:(e.addClass("invalid"),e.after(t("<div>").addClass("error-display").append(t("<label>").text("Please enter a valid email address."))),i||t("#friend-no-email-container").scrollTop(e.position().top-10),!1)},a.done_with_selection=function(e,i){var o;a.log_click("Visual Friend Selector","Complete Button",{total_selected:a.v_friends_selected.length}),a.v_no_email.length>0?(a.log_view("Visual Friend Selector","Need Emails Overlay",{total_selected:a.v_friends_selected.length,without_email:a.v_no_email.length}),o=Mustache.to_html(a.popup_templates.friend_selector_no_email_pane,{no_emails:a.v_no_email}),t("#select-friends-done").fadeOut(),e.find("#friend-selector").append(o),t("#friend-no-email-overlay").css({top:t("#filter-div").position().top}),t("#people-cover").css({height:t("#filter-div").height()+6}),e.find("#friend-no-email-overlay").fadeIn(),t("#done-no-email").live("click",function(){var o,n,c,s=!1,l=0;t(".no-email-input").removeClass("invalid"),e.find(".error-display").remove(),t.each(e.find(".no-email-input"),function(e,i){n=t(i).val(),""!==n?r(t(i),s)?(c=parseInt(t(i).data("master-id"),10),o=a.friend_data_dict[c],o.email=n,o.have_email=!0,a.v_with_email=a.v_with_email.concat(o)):s=!0:l++}),s||(a.log_click("Visual Friend Selector","Need Emails Overlay - Done Button",{total_selected:a.v_friends_selected.length,without_email:a.v_no_email.length,left_blank:l}),t.each(a.v_friends_selected,function(e,i){-1==t.inArray(i,a.v_with_email)&&(t("#token-"+i.master_id).remove(),t("#grid-"+i.master_id).removeClass("selected"))}),a.v_friends_selected=a.v_with_email,e.find("#friend-no-email-overlay").fadeOut(function(){i(e),e.find("#friend-no-email-overlay").remove()}),t("#done-no-email").die("click"))})):i(e)},a.process_selected=function(){var e,i,o=[],n=[],r=[];t.each(t("#filter-div").children("span"),function(c,s){e=parseInt(t(s).attr("id").split("-")[1],10),i=a.friend_data_dict[e],o=o.concat(i),i.have_email?n=n.concat(i):r=r.concat(i)}),a.v_friends_selected=o,a.v_with_email=n,a.v_no_email=r},a.prev_pane_calc_friends=function(e){var i;t("#select-friends-done").fadeIn(),e.find("#select-friends-done-hidden > a").click(),a.v_friends_selected.length>0?(e.find("#bookmarked-popup-add-friends").hide(),e.find("#bookmarked-popup-friends-added").show(),i=1==a.v_friends_selected.length?" friend selected":" friends selected",e.find("#num-friends-selected").text(a.v_friends_selected.length+i),t("#cinematic-note-people").empty(),t.each(a.v_friends_selected,function(e,i){t("#cinematic-note-people").append(t("<img/>").css({width:"30px",height:"30px","margin-right":"5px"}).attr({src:i.mugshot}).fadeIn(500))})):(t("#cinematic-note-people").empty(),e.find("#bookmarked-popup-add-friends").show(),e.find("#bookmarked-popup-friends-added").hide())}},a.clean_up_visual_friend_selector=function(){t(".friend-item").die("click"),t(".token-close").die("click")},a.button_spinner_start=function(e,i){var o,n=e;n.hide(),o=t("<div id='status-div'>").css({height:"35px"}).append(i,t("<img/>").attr({src:a.make_static_url("/images/ajax-loader-small.gif")})).appendTo(n.parent())},a.button_spinner_reset=function(e){t("#status-div").remove(),e.show()},a.button_spinner_end=function(e){var i;i=t("#status-div"),i.text("Success!").append(t("<div class='share-tab-icon-tick'/>")),e&&setTimeout(function(){t("#bookmarked-popup").dragonPopup("close"),t("#cancel").length>=0&&t("#cancel").click()},2e3)},a.refresh_user_grid=function(e,i){a.server_call("refresh_usergrid",e,function(e){0!==e.rc?1==e.rc?a.alert(e.message):2==e.rc&&t(i).fadeOut():t(i).fadeOut(function(){t(this).html(e.usergrid).fadeIn(),a.load_deferred_images()})})},a.intro_follow_init=function(){var e=function(e,i,o){return function n(a){return function(){a<e.length?(setTimeout(n(a+1),50),0===i?t.browser.msie?t(e[a]).hide():t(e[a]).fadeOut():t.browser.msie?t(e[a]).show():t(e[a]).fadeIn()):o()}}(0)};setTimeout(e(t("#neighborhood .pin"),1,t.noop),500),t("#more-pins").click(function(){return t("#category-2").show(),e(t("#category-2 .pin"),1,t.noop)(),a.log_click("Intro Follow","More Pins",{already_selected:t("#category .selected").length,post_intro:a.post_intro}),!1}),t("#next-1").click(function(){var i=[],o=[];t.each(t("#neighborhood .pin"),function(e,i){o.push(t(i).data("pin-id"))}),t("#neighborhood .selected").length<=0?(t("#n-follow-error").text("Please select at least one neighborhood"),t("#n-follow-error").css({visibility:"visible"}),a.log_view("Intro Follow","Follow Neighborhoods Button - None Selected")):(t("#n-follow-error").css({visibility:"hidden"}),window.scrollTo(0,0),t(".intro-text-1").fadeOut(),e(t("#neighborhood .pin"),0,function(){t("#neighborhood").hide(),t("#category").show(),t("#next-1").fadeOut(),t(".intro-text-2").fadeIn(),setTimeout(e(t("#category .pin"),1,function(){t("#next-2, #more-pins-container").fadeIn(),a.log_view("Intro Follow","Intro Follow Page 2",{post_intro:a.post_intro})}),400)})(),t.each(t("#neighborhood .selected"),function(e,o){i.push(t(o).data("pin-id"))}),a.server_call("follow_objects",{pin_type:"neighborhood",pin_ids:t.toJSON(i)})),a.log_click("Intro Follow","Follow Neighborhoods Button",{num_displayed:o.length,pins_displayed:o,num_selected:i.length,pins_selected:i,post_intro:a.post_intro})}),t("#next-2").click(function(){var e=[],i=[],o=[],n=[];t.each(t("#category .pin"),function(e,o){i.push(t(o).data("pin-id"))}),t.each(t("#category-2 .pin"),function(e,i){n.push(t(i).data("pin-id"))}),t("#category .selected, #category-2 .selected").length<=0?(t("#n-follow-error").text("Please select at least one category"),t("#n-follow-error").css({visibility:"visible"}),a.log_view("Intro Follow","Follow Categories Button - None Selected")):(t(this).unbind("click"),t.each(t("#category .selected"),function(i,o){e.push(t(o).data("pin-id"))}),t.each(t("#category-2 .selected"),function(e,i){o.push(t(i).data("pin-id"))}),a.skip_post_follow_flow_url?window.location=a.skip_post_follow_flow_url:a.post_intro?(a.log_view("Intro Follow","Complete",{post_intro:!0}),window.location=a.step1_url+"?post_intro=true&next="+a.post_intro_next):a.view_instarecs(),a.server_call("follow_objects",{pin_type:"category",pin_ids:t.toJSON(e.concat(o))})),a.log_click("Intro Follow","Follow Categories Button",{num_displayed:i.length,pins_displayed:i,num_selected:e.length,pins_selected:e,num_displayed_more:n.length,pins_displayed_more:n,num_selected_more:o.length,pins_selected_more:o,post_intro:a.post_intro})}),t("#intro-follow .pin").live("click",function(){var e,i=t(this);e={pin_type:i.data("pin-type"),pin_id:i.data("pin-id"),pin_pos:i.data("pin-pos"),post_intro:a.post_intro,more_pin:i.data("more-pin")},i.hasClass("selected")?(i.removeClass("selected"),e.follow=!1):(i.addClass("selected"),e.follow=!0),a.log_click("Intro Follow","Pin Click",e)})},a.create_spinner=function(e,t,i){var n={lines:12,length:4*t*.25||4,width:2,radius:t||5,color:i||"#fff",speed:1,trail:60,shadow:!1},a=new o(n).spin();return e.append(a.el),a},a.feed_init_masonry=function(){a.wall=t("#home-friend-grid-inner").masonry({columnWidth:function(e){return e/3}})},a.hide_loading_feed_ui=function(){t("#home-friend-grid-loader-outer").hide(),t("#home-friend-grid-loader-footer").show()},a.init_feed_values=function(e,t){e?(a.feed_has_more_results=!0,a.feed_page_num=0):(a.feed_has_more_results=t,a.feed_page_num=1),a.feed_is_fetching=!1,a.feed_initial_load_timestamp=Math.round((new Date).getTime()/1e3)},a.get_more_feed_results_helper=function(e,i,o,n){a.feed_has_more_results&&!a.feed_is_fetching&&(a.feed_is_fetching=!0,a.server_call(i,e,function(e){0===e.rc?(a.log_view("User",n,{page_num:a.feed_page_num,total_feed_stories:e.total_feed_stories,current_feed_stories:e.current_feed_stories,earliest_timestamp:e.earliest_timestamp}),a.feed_has_more_results=e.has_more,a.feed_page_num++,a.feed_is_fetching=!1,t("#home-friend-grid-inner").append(e.feed_items),o?a.feed_init_masonry():a.relayout_feed(),a.load_deferred_images(),a.feed_has_more_results||a.hide_loading_feed_ui()):a.alert(e.message)}))},a.get_more_homepage_feed_results=function(e,t){a.get_more_feed_results_helper({page:a.feed_page_num,force_feed_calculation:e,seen_promo_ids:JSON.stringify(t),initial_load_timestamp:a.feed_initial_load_timestamp},"get_more_homepage_feed_results",e,"Homepage More Feed")},a.homepage_feed_follow_user=function(e,i){var o={user_strids:JSON.stringify([t(e).data("user-strid")]),value:i,src:"feed"},n=t(e),r=n.parent();return a.server_call("follow_users",o,function(e){0!==e.rc?a.alert(e.message):(r.hide(),r.siblings().fadeIn())}),a.log_click("User","Follow user",o),!1},a.relayout_feed=function(){a.wall&&a.wall.masonry("reload")},a.get_more_user_recent_activity_feed_results=function(e){a.get_more_feed_results_helper({page:a.feed_page_num,user_strid:e,show_out_of_geo_badge:!0},"get_more_user_recent_activity_feed_results",!1,"Profile Recent Activity More Feed")},a.feed_bookmark_click=function(e,i){var o=t(this),n=a.setup_cinematic_popup_data(t(this)),r=Mustache.to_html(a.popup_templates.cinematic_shell,t.extend(n,{popup_title:"Bookmark This Activity"}),{pane:a.popup_templates.bookmark_pane});return a.show_bookmark_popup(r,i),a.bookmark_callback=function(){a.feed_bookmark_callback(o)},!1},a.feed_bookmark_callback=function(e){var i=t(".feed-story-bookmark-link-"+a.activity_id).not(e).add(e);a.activity_objects[a.activity_id].bookmarked?(t(".search-result-bookmark-notforme-common",i).removeClass("search-result-bookmark").addClass("search-result-bookmark-complete").css("opacity",1),i.data("tooltip").getTip().text("You've Bookmarked This")):(t(".search-result-bookmark-notforme-common",i).removeClass("search-result-bookmark-complete").addClass("search-result-bookmark"),i.data("tooltip").getTip().text("Bookmark This"))},a.setup_homepage_promo_block=function(){function e(){s=""}function i(){clearInterval(n),n=setInterval(function(){o()},4e3)}function o(){t(".selected-overlay").animate({top:t("#sub-promo-right-"+(r+1)).position().top+4},1e3),t(".promo-container:visible").fadeOut(1e3),t("#promo-container-"+(r+1)).fadeIn(1e3),r=(r+1)%3}var n,r=1,c=!1,s="";t(".selected-overlay").css({top:t("#sub-promo-right-1").position().top+4}),t(".selected-overlay").show(),a.log_view("User","Homepage Promo",{}),t(".sub-promo-right").each(function(e,i){a.log_view("User","Homepage Promo Items",{position:t(i).data("position"),type:t(i).data("type"),p_id:t(i).data("pid")})}),t(".sub-promo-right").click(function(i){s!=i.target.id&&(s=i.target.id,c=!0,t(".selected-overlay").stop(!0),t(".selected-overlay").animate({top:t(this).position().top+4},1e3,e),t(".promo-container:visible").fadeOut(1e3),t("#promo-container-"+t(this).data("position")).fadeIn(1e3),clearInterval(n),a.log_click("User","Homepage Promo Sub",{position:t(this).data("position"),type:t(this).data("type"),p_id:t(this).data("pid")}))}),t(".selected-overlay").click(function(){c=!0,clearInterval(n)}),t(".main-promo-left").hover(function(){c||clearInterval(n)},function(){c||i()}),i()},a.setup_landing_page_activities=function(){function e(e,i){t(".activity-container-"+e+":visible").fadeOut(1e3),t("#activity-container-"+e+"-"+(n[i]+1)).fadeIn(1e3),a.log_view("Signup","Landing Page - Activity Hover",{category:e,activity:n[i]+1}),n[i]=(n[i]+1)%5}function i(t,i){o=setInterval(function(){e(t,i)},2250)}var o,n=[1,1,1,1,1,1],r=!1;t(".activity-and-category").click(function(){a.log_click("Signup","Landing Page - Activity Click",{category:t(this).data("catid")})}),t(".activity-and-category").hover(function(){var n=t(this).data("catid"),a=parseInt(t(this).data("catid"),10)-1;r=!1,t(".activity-and-category-"+n).css({opacity:"1"}),t(".activity-and-category").not(".activity-and-category-"+n).css({opacity:".67"}),clearInterval(o),e(n,a),i(n,a)},function(){var e=t(this).data("catid");r=!0,setTimeout(function(){r&&t(".activity-and-category").not(".activity-and-category-"+e).css({opacity:"1"})},250),clearInterval(o)})},a.setup_landing_page_tastemaker_slider=function(){var e={circular:!0,infinite:!0,responsive:!1,auto:{play:!1},items:{visible:3},direction:"left",scroll:{easing:"swing",duration:750,onBefore:function(e){a.log_view("Signup","Landing Page - Scroller Click",{button:e.scroll.direction})}},next:{button:"#tm-right-scroll"},prev:{button:"#tm-left-scroll"}};t("#tastemaker-scroller").carouFredSel(e),t(".tastemaker-card").click(function(){a.log_click("Signup","Landing Page - Tastemaker Click",{card:t(this).data("tm")})})},a.category_quick_search_more=function(){var e,i=t("#step2-more");a.getting||(a.getting=!0,a.current_page=a.current_page+1,a.log_view("Recommendations","Results - Load",{page:a.current_page}),a.server_call("category_quick_search_more",{strid:a.quick_category_strid,page:a.current_page},function(o){e=t(o.results_section),t("#step2-other-activities").append(t("<hr>"),e),a.load_deferred_images(),a.results_log_summary_view(10*(a.current_page-1)+1),o.is_more||i.hide(),a.getting=!1}))},a.setup_invite_page=function(e,i,o,n,r){var c,s,l,d,u,_,p,m=1,f="get_all_invite_friends",h=0;c=window.unescape(i.invite_friend),e?(s="Intro Invite",t(window).scroll(function(){t(window).scrollTop()>250?t("#continue-bar").slideDown("slow"):t("#continue-bar").slideUp("slow")}),a.log_view("User",s+" Page",{existing_friends:a.existing_friends})):(s=a.tshirt_promo?"TShirt Invite":"Invite Follow",t(window).scroll(function(){t(window).scrollTop()>400?t("#scroll-to-top").slideDown("slow"):t("#scroll-to-top").slideUp("slow")}),t("#scroll-to-top").click(function(){window.scrollTo(0,0),a.log_click(s+" Page","Scroll To Top")}),t(".follow-friend-toggle").click(function(){var e=t(this);a.follow_friend(e,t(".follow-friend-tab-content:visible").data("tabname"))}),t("#following-show-hide").click(function(){t("#existing-friends:visible").length?(t("#existing-friends").slideUp(),t("#following-dropdown-container .round-arrow-button").addClass("image-vertical-flip"),t("#following-show-hide > span").text("show"),a.log_click("User",s+" Page - Followed",{already_following:o,show:!1})):(t("#existing-friends").slideDown(),t("#following-dropdown-container .round-arrow-button").removeClass("image-vertical-flip"),t("#following-show-hide > span").text("hide"),a.log_click("User",s+" Page - Followed",{already_following:o,show:!0}))})),d=function(e,i){var o;o=Mustache.to_html(c,{all_fb_friends:e,static_url_base:r,page:m,tshirt:a.tshirt_promo}),i?(t("#all-friends").hide(),t("#search-friends").empty(),t("#search-friends").append(o)):(t("#all-friends").append(o),a.load_deferred_images())},u=function(e){var i;i=Mustache.to_html(c,{all_fb_friends:e,static_url_base:r,page:1,tshirt:a.tshirt_promo,reminder:!0}),t("#reminder-container").show(),t("#reminder-container").append(i),a.load_deferred_images()},t(window).scroll(function(){t(window).scrollTop()>t("#invite-friends").offset().top+t("#invite-friends").height()-t(window).height()-1e3&&t("#invite-friends").is(":visible")&&m<Math.ceil(l.length/50)&&(0===t("#friend-filter").val().length||"Find a friend"==t("#friend-filter").val())&&(d(l.slice(50*m,50*(m+1)),!1),m+=1)}),a.tshirt_promo&&(f+="_tshirt"),p=setInterval(function(){h+=1,a.server_call(f,function(e){0===e.rc?(clearInterval(p),l=e.invite_pkg,d(l.slice(0,50),!1),a.tshirt_promo&&(n=e.num_reminders,e.reminder_friends_pkg.length>0?u(e.reminder_friends_pkg):t("#reminder-no-friends").show()),t("#spinner").remove(),t(".fb-friends-tab").show(),t("#facebook-friends .follow-friend-toggle:visible").length>0&&(t("#follow-all").show(),t("#follow-all").click(function(){return t(this).hide(),t("#followed-all").show(),a.follow_all_friends(),!1})),a.log_view("User",s+" Page - Load All Friends",{num_friends:l.length,reminders:n,already_following:o,num_polls:h})):h>=10&&(clearInterval(p),t("#spinner").remove(),t("#tshirt-invite-friend-container").append("<div style='position: absolute; top: 166px; left: 175px; color: lightCoral;'>We've encountered an error while loading your friends. Please refresh the page.</div>"),a.log_view("User",s+" Page - Load Error",{num_polls:h}))})},2e3),t("#friend-filter").keyup(function(){clearTimeout(_);var e,i,o,n,r=t.trim(t("#friend-filter").val().toLowerCase()),c=[];r.length>=1?_=setTimeout(function(){c=t.grep(l,function(t){return o=t.name.toLowerCase().split(" "),e=o[0],i=o[1],n=r.split(" "),n.length>1&&""===n[1]&&(n=[n[0]]),n.length>1?0===e.indexOf(n[0])&&0===i.indexOf(n[1])||0===e.indexOf(n[1])&&0===i.indexOf(n[0]):0===e.indexOf(n[0])||0===i.indexOf(n[0])}),d(c,!0),a.load_deferred_images(),a.log_view("User",s+" - Filter",{filter_content:t("#friend-filter").val()})},400):(t("#all-friends").show(),t("#search-friends").empty())}),t(".invite-button").live("click",function(){a.send_invite_to_fb_user_button(t(this),t(this).data("fb-id"))})},a.display_error=function(e){t("#global-error").text(e),t("#global-error").slideDown().delay(5e3).slideUp()},a.setup_dragon_dropdown=function(e,i,o,n){var a=t(".header-selected").html().trim();t("body").not(e).click(function(){e.hasClass("opened")&&(e.removeClass("opened"),e.children(".dropdown-list").slideUp(200),t(".header-selected").html(a),n(!1,e.data("value")))}),e.click(function(){return 0===e.children(".dropdown-list:visible").length?(e.addClass("opened"),e.children(".dropdown-list").slideDown(200),n(!0,e.data("value"))):(e.removeClass("opened"),e.children(".dropdown-list").slideUp(200),n(!1,e.data("value"))),!1}),t("body").not(e).hover(function(){return e.hasClass("opened")||t(".header-selected").html(a),!1},function(){}),e.hover(function(){return t(".header-selected").html(t("<div/>").addClass("choice-content").css({"pointer-events":"none"}).append(i)),!1},function(){return e.hasClass("opened")||t(".header-selected").html(a),!1}),e.find(".choice").click(function(){var i=t(this);return e.find(".choice.selected").removeClass("selected"),i.addClass("selected"),e.find(".header-selected").html(i.html()),a=t(".header-selected").html().trim(),e.data("value",i.data("value")),e.children(".dropdown-list:visible").length>0&&(e.removeClass("opened"),e.children(".dropdown-list").slideUp(200),n(!1,e.data("value"))),o(i),!1})},t.modal.defaults.zIndex=1e4,t.modal.defaults.escClose=!1,t.modal.defaults.onOpen=function(e){e.data.show(),e.container.fadeIn(500),e.overlay.fadeIn(500)},t(document).ready(function(){var e;e=new Image,e.onload=e.onerror=function(){(1!=this.width||1!=this.height)&&(document.documentElement.className+=" no-data-uri")},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a.load_deferred_images(),t("input[placeholder], textarea[placeholder]").placeholder(),t(".datepicker").datepicker({minDate:0,maxDate:"+2M",showAnim:"fold"}),t("#recommendations-filter-when-date-textbox").datepicker({minDate:0,maxDate:"+2M",showAnim:"fold",onSelect:a.recalc_sentence}),t(".showmore-button").live("click",function(){var e=t(this);return e.parent().find(".oh-so-much-more").slideToggle("fast"),e.text("More"==e.text()?"Fewer":"More"),a.load_deferred_images(),!1}),a.facebook_perms=t("#facebook-perms").val(),t(".signup-link").live("click",function(){s.log_click("Join Link","Join Link"),setTimeout(function(){window.location="/signup"},200)}),t(".login-link").live("click",r.show_signup_login_popup),t("#category-nav-bar").length>0&&(s.log_view("Nav Bar","Nav Bar",{version:2}),t("#category-nav-bar .category").hover(function(){t("#category-nav-bar-dropdown:visible").length>0&&(t(".category-pane").hide(),t("#category-nav-bar .category.selected").removeClass("selected"),t(this).addClass("selected"),t("#category-pane-"+t(this).data("position")).show(),s.log_click("Nav Bar","Hover",{category:t(this).text(),position:parseInt(t(this).data("position"),10)+1,version:2}))},function(){}),t("#category-nav-bar .category").hoverIntent({over:function(){return 0===t("#category-nav-bar-dropdown:visible").length&&(t(".category-pane").hide(),t("#category-nav-bar .category.selected").removeClass("selected"),t(this).addClass("selected"),t("#category-nav-bar-dropdown").show(),t("#category-pane-"+t(this).data("position")).show(),s.log_click("Nav Bar","Open",{category:t(this).text(),position:parseInt(t(this).data("position"),10)+1,version:2}),s.log_click("Nav Bar","Hover",{category:t(this).text(),position:parseInt(t(this).data("position"),10)+1,version:2})),!1},out:function(){},sensitivity:7,interval:600}),t("#category-nav-bar .category").click(function(){return 0===t("#category-nav-bar-dropdown:visible").length?(t(".category-pane").hide(),t("#category-nav-bar .category.selected").removeClass("selected"),t(this).addClass("selected"),t("#category-nav-bar-dropdown").show(),t("#category-pane-"+t(this).data("position")).show(),!1):void s.log_click("Nav Bar","Click Category",{category:t(this).text(),version:2})}),t("#close-area").click(function(){t("#category-nav-bar .category.selected").removeClass("selected"),t("#category-nav-bar-dropdown").hide(),s.log_click("Nav Bar","Close",{version:2})}),t("#global-header-wide-1080").hover(function(){t("#category-nav-bar-dropdown:visible").length>0&&s.log_click("Nav Bar","Hover Close",{version:2}),t("#category-nav-bar .category.selected").removeClass("selected"),t("#category-nav-bar-dropdown").hide()},function(){}))}),String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},t.extend({keys:function(e){var i=[];return t.each(e,function(e){i.push(e)}),i}}),a.submit_activity={},a.submit_activity.setup=function(){a.submit_activity.scraped_item={},a.submit_activity.venue={},a.submit_activity.scraped_item.outside_id="",a.submit_activity.get_form_fields(),a.submit_activity.bind_buttons(),a.submit_activity.submit_button.hide(),t(".entry-section").hide(),a.create_spinner(a.submit_activity.loader,5,"#111"),t(a.submit_activity.start_date_field).datepicker({dateFormat:"mm/dd/yy",minDate:"+1w"}),t.extend(t.validator.messages,{required:"required",url:"invalid url",date:"invalid date",email:"invalid email"}),t("#submit-activity-form").validate({onfocusout:function(e){t(e).valid()},submitHandler:function(){a.log_click("Flat Page","Submit Activitity Submit",{submit:!0,step:"3"}),a.submit_activity.activity_form_submit()},errorClass:"invalid",errorElement:"span",rules:{venue_name_input:{required:function(){return!a.submit_activity.venue.id}}},messages:{invalid:"required"}})},a.submit_activity.get_form_fields=function(){a.submit_activity.error_message=t("#error-message"),a.submit_activity.step_1_section=t("#submit-activity-step-1"),a.submit_activity.email_field=t("#email-input"),a.submit_activity.event_name_field=t("#event-name-input"),a.submit_activity.event_details_url_field=t("#event-details-url-input"),a.submit_activity.step_2_section=t("#submit-activity-step-2"),a.submit_activity.event_name_label=t(".event-name-label"),a.submit_activity.description_field=t("#description-input"),a.submit_activity.start_date_field=t("#date-input"),a.submit_activity.start_time_field=t("#time-select"),a.submit_activity.ticketing_url_field=t("#ticketing-url-input"),a.submit_activity.ticketing_price_field=t("#ticketing-price-input"),a.submit_activity.step_3_section=t("#submit-activity-step-3"),a.submit_activity.foursquare_search_field=t("#4square-venue-input"),a.submit_activity.foursquare_search_button=t("#4square-search-button"),a.submit_activity.foursquare_search_list=t("#4square-venue-choices"),a.submit_activity.venue_name_field=t("#venue-name-input"),a.submit_activity.venue_street_field=t("#venue-address-input"),a.submit_activity.venue_city_state_zip_field=t("#venue-city-state-zip-input"),a.submit_activity.submit_button=t("#step-3-submit"),a.submit_activity.loader=t("#submit-activity-loader")},a.submit_activity.show_spinner=function(e){e?a.submit_activity.loader.show():a.submit_activity.loader.hide()},a.submit_activity.show_error_popup=function(e,i,o){var n={};a.log_view("Flat Page","Submit Activity Error Popup"),n[i]=function(){a.log_click("Flat Page","Submit Activity Close Error Popup"),t(this).dragonPopup("close")},o&&(n.Proceed=function(){a.log_click("Flat Page","Submit Activity Proceed Error Popup"),o(),t(this).dragonPopup("close")}),t("<div />").css({textAlign:"center"}).append(e).dragonPopup({title:"Error",minWidth:200,minHeight:200,buttons:n})},a.submit_activity.bind_buttons=function(){t("#step-1-button").bind("click",function(){a.submit_activity.step_1_click()}),t(".simple-button").bind("click",function(){a.log_click("Flat Page","Submit Activitity - Navigation Button",{step:t(this).data("step"),next_step:t(this).data("nextstep")});var e=t("#submit-activity-step-"+t(this).data("step")),i=t("#submit-activity-step-"+t(this).data("nextstep"));e.hide(),i.show()}),t("#step-3-back-button").bind("click",function(){if(t(".search-section").is(":visible")){a.log_click("Flat Page","Submit Activitity - Navigation Button",{step:t(this).data("step"),next_step:t(this).data("nextstep")});var e=t("#submit-activity-step-"+t(this).data("step")),i=t("#submit-activity-step-"+t(this).data("nextstep"));e.hide(),i.show()}else a.log_click("Flat Page","Submit Activitity - Navigation Button",{venue_section:"search-section",step:"3"}),t(".venue-section").hide(),t(".search-section").show(),t(".search-error").hide(),t(".list-element").removeClass("selected"),a.submit_activity.venue.id&&delete a.submit_activity.venue.id}),t(".show-link").bind("click",function(){return a.log_click("Flat Page","Submit Activitity - Navigation Button",{venue_section:t(this).data("related"),step:"3"}),t(".venue-section").hide(),t("."+t(this).data("related")).show(),t(".list-element").removeClass("selected"),t(".search-error").hide(),a.submit_activity.venue.id&&delete a.submit_activity.venue.id,!1}),a.submit_activity.foursquare_search_button.bind("click",function(){a.log_click("Flat Page","Submit Activitity - Foursquare Search",{foursquare_venue_search:!0,step:"3",search:a.submit_activity.foursquare_search_field.val()}),a.submit_activity.foursquare_search_click()}),t("#submission-popup-link").bind("click",function(){a.log_click("Flat Page","Submit Activitity - View Tips",{tips_popup_show:!0,step:"1"}),a.log_view("Flat Page","Submit Activity - View Tips",{tips_popup:!0}),a.submit_activity.tips_popup||(a.submit_activity.tips_popup=t("#submission-popup").dragonPopup({minWidth:700,maxWidth:700,buttons:{Close:function(){a.log_click("Flat Page","Submit Activitity - Close Tips Popup",{tips_popup_show:!1,step:"1"}),t(this).dragonPopup("close")
}}}),a.submit_activity.tips_popup.show()),a.submit_activity.tips_popup.dragonPopup("show")})},a.submit_activity.step_1_click=function(){var e=a.submit_activity.event_details_url_field.val();"http"!==e.substring(0,4)&&(e="http://"+e,a.submit_activity.event_details_url_field.val(e)),a.submit_activity.event_details_url_field.valid()?(a.log_click("Flat Page","Submit Activitity - Scrape URL Button",{scrape_url:!0,step:"1",next_step:"2",can_proceed:!0,valid_email:a.submit_activity.email_field.valid(),valid_event_name:a.submit_activity.event_name_field.valid(),valid_url:a.submit_activity.event_details_url_field.valid()}),a.submit_activity.show_spinner(!0),a.server_call("scrape_url",{scrape_url:e},function(e){a.submit_activity.show_spinner(!1),a.submit_activity.proceed_from_step_1(e)})):a.log_click("Flat Page","Submit Activitity - Scrape URL Button",{scrape_url:!1,step:"1",next_step:"2",can_proceed:!1,valid_email:a.submit_activity.email_field.valid(),valid_event_name:a.submit_activity.event_name_field.valid(),valid_url:a.submit_activity.event_details_url_field.valid()})},a.submit_activity.fill_field=function(e,t){var i=new Date(e.start_date),o=i.getHours(),n=i.getMinutes(),r=Math.abs(0-n),c=Math.abs(30-n),s=Math.abs(60-n),l="",d="";a.submit_activity.scraped_item.outside_id=e.outside_id,a.submit_activity.event_name_field.val()||a.submit_activity.event_name_field.val(e.title),a.submit_activity.description_field.val(e.description),a.submit_activity.ticketing_url_field.val(e.purchase_url||""),a.submit_activity.ticketing_price_field.val(e.price),a.submit_activity.start_date_field.val(i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()),a.submit_activity.foursquare_search_field.val(t.name),a.submit_activity.venue_name_field.val(t.name),a.submit_activity.venue_street_field.val(t.street),a.submit_activity.venue_city_state_zip_field.val(a.submit_activity.create_address_listing(t,["city","region","zip_code"])),t.name&&a.submit_activity.foursquare_search_click(!0),o>11?(l="pm",o-=12):l="am",o=o?o:12,d+=o,d+=":",n=c>r||c>s?"00":"30",d+=n,d=d+" "+l,a.submit_activity.start_time_field.val(d)},a.submit_activity.proceed_from_step_1=function(e){var t=function(){a.submit_activity.event_name_label.html(a.submit_activity.event_name_field.val()),a.submit_activity.step_1_section.hide(),a.submit_activity.step_2_section.show()};e.rc?(a.submit_activity.email_field.valid(),a.submit_activity.event_name_field.valid(),3===e.rc?t():a.submit_activity.email_field.valid()&&a.submit_activity.event_name_field.valid()&&a.submit_activity.show_error_popup(e.messages[0].message,"Edit & Retry",t)):e.scraped_item&&(a.submit_activity.scraped_item=e.scraped_item,a.submit_activity.venue=e.scraped_item.venue,delete a.submit_activity.scraped_item.venue,a.submit_activity.fill_field(a.submit_activity.scraped_item,a.submit_activity.venue),a.submit_activity.email_field.valid(),a.submit_activity.event_name_field.valid(),a.submit_activity.email_field.valid()&&a.submit_activity.event_name_field.valid()&&t())},a.submit_activity.create_address_listing=function(e,i){var o=[];return t.each(i,function(t,i){e[i]&&o.push(e[i])}),o.join(",")},a.submit_activity.foursquare_search_click=function(e){var i=a.submit_activity.foursquare_search_field.val(),o={};a.submit_activity.venue.name===i&&(o.venue_address=a.submit_activity.create_address_listing(a.submit_activity.venue,["address","city","region"])),o.venue_name=i,e||a.submit_activity.show_spinner(!0),a.server_call("lookup_4square_venue",o,function(i){a.submit_activity.show_spinner(!1),!i.rc&&i.show_search_list?a.submit_activity.fill_search_list(i.template_dom):e||(t(".search-section").hide(),t(".search-error").show(),t(".entry-section").show())})},a.submit_activity.fill_search_list=function(e){a.submit_activity.foursquare_search_list.html(e),t(".list-element").bind("click",function(){t(".list-element").removeClass("selected"),t(this).addClass("selected"),a.submit_activity.submit_button.show(),a.submit_activity.venue.id=t(this).data("venueid")})},a.submit_activity.activity_form_submit=function(){var e=a.submit_activity.scraped_item,i=a.submit_activity.venue,o=a.submit_activity.email_field.val(),n={};n.email=o,e.title=a.submit_activity.event_name_field.val(),e.url=a.submit_activity.event_details_url_field.val(),e.description=a.submit_activity.description_field.val(),e.start_date_str=a.submit_activity.start_date_field.val(),e.start_time_str=a.submit_activity.start_time_field.val(),e.purchase_url=a.submit_activity.ticketing_url_field.val(),e.price=a.submit_activity.ticketing_price_field.val(),i.name=a.submit_activity.venue_name_field.val(),i.street=a.submit_activity.venue_street_field.val(),i.city_state_zip=a.submit_activity.venue_city_state_zip_field.val(),t.each(e,function(e,t){e="scraped_item_"+e,n[e]=t}),t.each(i,function(e,t){e="venue_"+e,n[e]=t}),a.submit_activity.show_spinner(!0),a.server_call("create_user_submitted_item",n,function(e){return a.submit_activity.show_spinner(!1),e.rc?void a.submit_activity.show_error_popup("Error submitting your activity.","Close"):void(document.location="../submit_activity_thanks/")})},a.summary_view_log_in_view=function(e,i,o){var n={area:i,params:o},r=a.log_summary_view;a.do_summary_logging&&t(e).bind("inview",n,function(e,i,o,n){var a=t(this);a.data("inviewtimer")&&(clearTimeout(a.data("inviewtimer")),a.removeData("inviewtimer")),i&&a.data("inviewtimer",setTimeout(function(){"top"==n?a.data("seenTop",!0):"bottom"==n?a.data("seenBottom",!0):(a.data("seenTop",!0),a.data("seenBottom",!0)),a.data("seenTop")&&a.data("seenBottom")&&(a.unbind("inview"),r(e.data.area,e.data.params))},300))})},a.results_log_summary_view=function(e){t("#step2-other-activities").find(".step2-other-result").each(function(i,o){var n,r={},c=t(o).find(".step2-other-title-overlay"),s=c.data("log-params"),l=s.position;l>=e&&(n=t(o).find(".step2-other-skinny"),r.list_position=l,r.activity_id=s.activity_id,void 0!==a.search_term&&(r.q=a.search_term),a.summary_view_log_in_view(n,c.data("log-area"),r))})},a.collection_log_summary_view=function(e){t("#step2-other-activities").find(".feed-big-story").each(function(i,o){var n,r={},c=t(o),s=c.data("item-number");s>=e&&(n=t(o).find(".feed-big-story-thumbnail"),r.list_position=s,r.activity_id=c.data("activity-id"),a.summary_view_log_in_view(n,c.data("log-area"),r))})},e}(OFFLINE||{},jQuery,_gaq,Spinner),OFFLINE=function(e,t,i,o){"use strict";var n=e.logger,a=e.base,r=a.payments=a.payments||{},c={TICKETING:"ticket-selection",CREDITCARD:"creditcard"};return r.CURRENT_CENTURY="20",r.ticketSelected=!1,r.quantity=1,r.tax_and_tip=0,r.currentView=c.TICKETING,r.defaultOpts={params:{},ref:"",disablePurchase:!1,mobile:!1},r.init=function(e){t.extend(r,r.defaultOpts),t.extend(r,e),Stripe.setPublishableKey(r.publishableKey),r.getDomEls_();var i=a.create_spinner(r.spinnerEl,20,"#111");r.verticalCenteringIconsHack(),r.preselectTicketType(),r.attachEventsFn(),i.stop()},r.getDomEls_=function(){r.container=t("#sosh-checkout-container-v3"),r.form=r.container.find("#payment-form"),r.purchaseButton=r.container.find(".purchase-button"),r.workingButton=r.container.find(".working-button"),r.spinnerEl=r.container.find(".spinner-el"),r.quantityError=r.container.find(".quantity-error"),r.cardError=r.container.find(".card-error"),r.selectors=r.container.find(".selector"),r.summaryBox=r.container.find(".summary-row"),r.ticketTypeSelector=r.container.find(".ticket-select-type"),r.multiTicketSelector=r.container.find(".ticket-select-quantity"),r.timeslotSelector=r.container.find(".ticket-select-timeslot"),r.optionSelector=r.container.find(".ticket-select-option"),r.footer=r.container.find(".checkout-footer"),r.modalSelectContainer=t(".modal-select")},r.verticalCenteringIconsHack=function(){var e=t("i.vertical-center");e.each(function(e,i){var o=t(this).parent().outerHeight(),n=t(this).height();t(i).css("top",(o-n)/2+"px")})},r.attachEventsFn=function(){t.validator.addMethod("cardNumber",Stripe.validateCardNumber,""),t.validator.addMethod("cardCVC",Stripe.validateCVC,""),t.validator.addMethod("cardExpiry",function(){var e=t(".card-month").val().trim(),i=t(".card-year").val().trim();return e&&!i?!0:Stripe.validateExpiry(e,r.CURRENT_CENTURY+i)},""),t.extend(t.validator.messages,{required:"",email:"",digits:""}),r.form.validate({debug:!0,submitHandler:r.submitFn,errorClass:"error",rules:{name:{required:{depends:function(){return t(this).val(t.trim(t(this).val())),!0}}},"card-number":{cardNumber:!0,required:!0},"card-cvc":{cardCVC:!0,required:!0},"card-month":{cardExpiry:!0,required:!0},"card-year":{cardExpiry:!0,required:!0}},groups:{expirationDate:"card-month card-year"}}),r.selectors.on("click",function(e){t(e.currentTarget).hasClass("disabled")||t(e.currentTarget).hasClass("checkbox")||r.onSelectorClick(e.currentTarget)}),r.optionSelector.on("click","a",function(e){e.preventDefault(),r.onCheckboxClick(e.currentTarget)}),r.purchaseButton.on("click",function(){if(!r.purchaseButton.hasClass("disabled")){if(r.disablePurchase)return!1;if(r.ticketSelected)return r.form.submit(),!1;if(!r.validateTicketSelection())return!1;r.showCreditCardView(),n.log_click("Payment Form","Purchase Click",{ref:r.ref,quantity:r.quantity,ticket_type_id:r.ticketTypeId,timeslot:r.timeSlotId,option_purchased:r.optionPurchased,price:r.price,event_id_str:r.eventId,mobile:r.mobile})}}),r.summaryBox.on("click",".edit-button",function(e){e.preventDefault(),r.showTicketingView()}),r.mobile&&(t("input").on("focus",function(){r.footer.hide()}),t("input").on("blur",function(){r.footer.show()})),r.form.find('input[type="text"]').off("keypress"),r.form.find(".card-expiry").payment("formatCardExpiry"),r.form.find(".card-number").payment("formatCardNumber"),r.form.find(".card-cvc").payment("formatCardCVC"),r.form.find('input[type="text"]').on("keypress",function(e){return 13===e.keyCode?void r.purchaseButton.click():void 0}),r.addNamesFn()},r.showCreditCardView=function(){var e=a.create_spinner(r.spinnerEl,20,"#111");r.ticketSelected=!0,r.currentView=c.CREDITCARD,r.form.find(".view-ticketing").fadeOut(400,function(){r.updatePrice(),r.summaryBox.show(),r.updateSummary(),r.form.find(".view-payment").fadeIn(400,function(){r.purchaseButton.text("Finish Purchase"),e.stop()})}),t(window).scrollTop(0)},r.showTicketingView=function(){var e=a.create_spinner(r.spinnerEl,20,"#111");r.ticketSelected=!1,r.currentView=c.TICKETING,r.form.find(".view-payment").fadeOut(400,function(){r.updatePrice(),r.updateSummary(),r.form.find(".view-ticketing").fadeIn(400,function(){r.purchaseButton.text("Buy Tickets"),e.stop()})}),t(window).scrollTop(0)},r.onSelectorClick=function(e){var i=t(e),o=i.next(".options"),n=i.find(".selected-option-container");r.modalSelectContainer.html(o.html()),r.modalShow(),r.verticalCenteringIconsHack(),r.modalSelectContainer.find(".option").on("click",function(e){var i=t(e.currentTarget);i.hasClass("disabled")||r.onModalOptionSelect(i,n,o)})},r.onCheckboxClick=function(e){var i=t(e);r.optionSelector.find("a").each(function(e,i){t(i).removeClass("selected")}),i.addClass("selected"),r.optionPurchased=i.data("purchase")?!0:!1,r.validateTicketSelection(!0),r.updatePrice()},r.onModalOptionSelect=function(e,i,o){{var n,a=e.find(".content")[0].outerHTML;o.find("ul:first").children(".option")}r.modalSelectContainer.find(".option").each(function(e,i){t(i).removeClass("selected")}),e.addClass("selected"),e.data("tickettypeid")&&(r.ticketTypeId=e.data("tickettypeid"),r.pricePerUnit=e.data("tickettypeprice"),r.ticketTypeTitle=e.find(".heading:first").text(),r.ticketTypeDescription=e.find(".description:first").text(),(r.quantity||r.optionPurchased||r.timeSlotId)&&(r.quantity=1,r.optionPurchased=void 0,r.timeSlotId=!1,r.multiTicketSelector.find(".selector").addClass("disabled"),r.optionSelector.find("a").each(function(e,i){t(i).removeClass("selected")})),n=e.find(".timeslots"),n.find(".option[data-timeslotid]").each(function(){var e=t(this).find(".content"),i=t(this).data("timeslotid");return i?(r.timeslotSelector.find(".selected-option-container").html(e.html()),r.setTimeSlot(t(this)),t(this).addClass("selected"),!1):void 0}),t(".options.timeslots").html(n.html()),parseInt(e.data("timeslotcount"),10)>1?r.timeslotSelector.find(".selector").removeClass("disabled"):r.timeslotSelector.find(".selector").addClass("disabled"),r.multiTicketSelector.find(".selected-option-container").html('<p class="heading">1 Ticket</p>'),r.updatePrice(r.quantity,r.pricePerUnit),"True"===e.data("tickettypeallowmulti")?r.multiTicketSelector.fadeIn():r.multiTicketSelector.hide(),"True"===e.data("tickettypehasoption")?(r.optionSelector.find(".option-content").html(e.find(".option-content").html()),r.optionSelector.fadeIn(),r.optionCost=parseInt(e.data("optioncost"),10),r.ticketTypeOptionTitle=e.find(".option-content:first .heading").text(),r.ticketTypeOptionDescription=e.find(".option-content:first .description").text()):(r.optionSelector.hide(),r.optionPurchased=!1),t(".options.quantities").find("li:first").addClass("selected"),r.validateTicketSelection(!0)),e.data("timeslotid")&&r.setTimeSlot(e),e.data("qty")&&(r.quantity=parseInt(e.data("qty"),10),r.updatePrice(e.data("qty"),r.pricePerUnit)),i.html(a),o.html(r.modalSelectContainer.html()),r.modalSelectContainer.empty(),r.modalHide()},r.setTimeSlot=function(e){r.timeSlotId=e.data("timeslotid"),r.timeSlot=e.find(".content:first .heading").contents().first().text().trim(),t(".options.quantities").html(e.next(".quantity").html()),r.multiTicketSelector.find(".selector.disabled").removeClass("disabled")},r.preselectTicketType=function(){var e=r.ticketTypeSelector.find(".selector"),i=e.next(".options"),o=e.find(".selected-option-container"),n=i.find("ul:first").children(".option");1===n.size()?(r.modalSelectContainer.html(i.html()),r.onModalOptionSelect(n.first(),o,i),t(".options.type").find("li:first").addClass("selected")):r.updateSummary({price:0})},r.modalShow=function(){r.scrollCache=t(window).scrollTop(),r.container.height(r.modalSelectContainer.outerHeight()),r.container.removeClass("modal-hide modal-remove"),r.container.addClass("modal-show"),r.hookModalHandlers(),setTimeout(function(){t(window).scrollTop(0)},200)},r.modalHide=function(){r.container.height("auto"),t(window).scrollTop(r.scrollCache),r.container.removeClass("modal-show"),r.container.addClass("modal-hide"),r.verticalCenteringIconsHack(),setTimeout(function(){r.container.addClass("modal-remove")},500)},r.hookModalHandlers=function(){var e=t(".modal-overlay-x");e.on("click",r.modalHide)},r.validateTicketSelection=function(e){return e?(r.quantityError.slideUp(),r.ticketTypeSelector.find(".selector").removeClass("error"),r.multiTicketSelector.find(".selector").removeClass("error"),r.timeslotSelector.find(".selector").removeClass("error"),void r.optionSelector.find(".selector").removeClass("error")):r.ticketTypeId?r.timeSlotId?void 0===r.optionPurchased?(r.quantityError.html("The option field is required."),r.quantityError.is(":hidden")&&r.quantityError.slideDown(),r.optionSelector.find(".selector").addClass("error"),n.log_click("Payment Form","Validation: Option Required",{ref:r.ref,quantity:r.quantity,ticket_type_id:r.ticketTypeId,timeslot:r.timeSlotId,option_purchased:r.optionPurchased,price:r.price,event_id_str:r.eventId,mobile:r.mobile}),!1):(r.quantityError.slideUp(),!0):(r.quantityError.html("You have not Selected a time to purchase"),r.quantityError.is(":hidden")&&r.quantityError.slideDown(),r.timeslotSelector.find(".selector").addClass("error"),!1):(r.quantityError.html("Select Ticket Type to Purchase"),r.quantityError.is(":hidden")&&r.quantityError.slideDown(),r.ticketTypeSelector.find(".selector").addClass("error"),n.log_click("Payment Form","Validation: Ticket Type Required",{ref:r.ref,quantity:r.quantity,ticket_type_id:r.ticketTypeId,timeslot:r.timeSlotId,option_purchased:r.optionPurchased,price:r.price,event_id_str:r.eventId,mobile:r.mobile}),!1)},r.addNamesFn=function(){r.form.find(".card-number").attr("name","card-number"),r.form.find(".card-cvc").attr("name","card-cvc"),r.form.find(".card-month").attr("name","card-month"),r.form.find(".card-year").attr("name","card-year")},r.removeNamesFn=function(){r.form.find(".card-number").removeAttr("name"),r.form.find(".card-cvc").removeAttr("name"),r.form.find(".card-month").removeAttr("name"),r.form.find(".card-year").removeAttr("name")},r.disablePurchaseFn=function(e){r.disablePurchase=e,r.disablePurchase?(r.purchaseButton.text("Verifying Payment..."),r.purchaseButton.addClass("disabled")):(r.purchaseButton.text("Finish Purchase"),r.purchaseButton.removeClass("disabled"))},r.submitFn=function(){var e;r.removeNamesFn(),r.disablePurchaseFn(!0),e=a.create_spinner(r.spinnerEl,20,"#111"),r.quantityError.is(":hidden")||r.quantityError.slideUp(),r.cardError.is(":hidden")||r.cardError.slideUp(),Stripe.createToken({number:r.form.find(".card-number").val(),cvc:r.form.find(".card-cvc").val(),exp_month:r.form.find(".card-month").val(),exp_year:r.form.find(".card-year").val()},function(t,i){return i.error?(e.stop(),r.disablePurchaseFn(!1),r.quantityError.slideDown(),r.quantityError.html(i.error.message),r.addNamesFn(),n.log_view("Credit Card Error",i.error.message,{ref:r.ref,quantity:r.quantity,ticket_type_id:r.ticketTypeId,timeslot:r.timeSlotId,option_purchased:r.optionPurchased,price:r.price,event_id_str:r.eventId,mobile:r.mobile}),!1):void a.server_call("sosh_ticket_purchase",{ref:r.ref,token:i.id,name:r.form.find('input[name="name"]').val(),email:r.form.find('input[name="email"]').val(),quantity:r.quantity,option_purchased:r.optionPurchased,displayed_price:r.price,str_event_id:r.eventId,str_ticket_type_id:r.ticketTypeId,str_timeslot_id:r.timeSlotId},function(t){var i=t.message||"";return 1===t.rc?(r.quantityError.text(i),r.quantityError.slideDown()):2===t.rc?(r.cardError.text(i),r.cardError.slideDown()):3===t.rc?(i='Your ticket choice is no longer availabe. <a href=".">Please select your ticket again</a>',r.cardError.html(i),r.cardError.slideDown()):4===t.rc?(r.cardError.text(i),r.cardError.slideDown()):5===t.rc?(r.cardError.text(i),r.cardError.slideDown(),r.purchaseButton.fadeOut()):t.rc&&(r.quantityError.text("Oops. Something went wrong."),r.quantityError.slideDown()),t.rc?(e.stop(),5!==t.rc&&r.disablePurchaseFn(!1),r.addNamesFn(),n.log_view("Purchase Error",t.message,{ref:r.ref,quantity:r.quantity,ticket_type_id:r.ticketTypeId,timeslot:r.timeSlotId,option_purchased:r.optionPurchased,price:r.price,event_id_str:r.eventId,mobile:r.mobile}),!1):void r.successCallback(t)})})},r.updatePrice=function(e,t){var i,o=0,n=r.currentView===c.CREDITCARD;if(r.optionPurchased&&(o=r.optionCost),e=parseInt(e,10)||r.quantity||1,t=t||r.pricePerUnit,i=parseInt(t,10)*e+o*e,n){var a=i/100*(r.tax_rate+r.tip_rate);r.tax_and_tip=Math.floor(100*a)/100,r.tax_and_tip_display=parseFloat(r.tax_and_tip).toFixed(2)}else r.tax_and_tip=r.tax_and_tip_display=0;r.price=i+r.tax_and_tip,r.price_display=n?parseFloat(r.price).toFixed(2):r.price,r.updateSummary()},r.updateSummary=function(e){e=e||{},t.extend(e,r),e.showSummaryDetails=r.currentView===c.CREDITCARD?!0:!1,e.ticketTotal=parseFloat(e.quantity*e.pricePerUnit).toFixed(2),e.optionTotal=parseFloat(e.quantity*e.optionCost).toFixed(2);var i=o.to_html(r.purchase_summary_template,e);r.summaryBox.html(i),r.mobile&&r.footer.find(".number").text(e.price)},r.successCallback=function(e){t(".form-container").fadeOut(400,function(){r.footer.hide(),t(".totals-row").hide(),r.container.find(".header").hide(),t(".last-four").text(e.last),t(".amount-charged").text("$"+parseFloat(e.amount).toFixed(2)),t(".final-email").text(e.email),t(".success-container").fadeIn(),t(window).scrollTop(0),n.log_view("Sosh Checkout Success Page","Success View",{ref:r.ref,quantity:r.quantity,ticket_type_id:r.ticketTypeId,timeslot:r.timeSlotId,option_purchased:r.optionPurchased,price:r.price,event_id_str:r.eventId,mobile:r.mobile})})},e}(OFFLINE||{},jQuery,_gaq,Mustache),OFFLINE=function(e,t,i,o){"use strict";var n=e.dragon=e.dragon||{},a=n.details=n.details||{},r=!1;return a.init=function(e,i,o,c,s,l){var d,u=!1,_=0;n.activity_details_version=3,r=l,o||a.mapbox(e,c,s,i),a.insider_tips(r),a.primary_actions(),a.share_actions(),a.layout_fixes(),r||(d=t("#logged-out-banner").offset().top,a.facepile_display()),setInterval(function(){_+=1},1e3),t(document).scroll(function(){var e=t(document).scrollTop()+window.innerHeight/1.2;e>t("#similar-activities").offset().top+t("#similar-activities").height()/3&&!u&&(n.log_view("Similar Activities","Similar Activities",{seconds_taken:_}),u=!0)}),t(".mugshot-tooltip[title]").tooltip({position:"bottom center",opacity:.9,offset:[5,0]}),t("#staff-warnings").click(function(){t(this).hide()})},a.facepile_display=function(){var e,i=0;e=setInterval(function(){i+=1,10===i&&(clearInterval(e),t("#logged-out-facepile iframe").width()>0&&n.log_view("Logged Out Banner","Facepile Display Failure",{width:t("#facepile-container iframe").width()})),t("#logged-out-facepile iframe").width()>=300&&(t("#logged-out-banner .heading").animate({"margin-top":"40px"},function(){t("#logged-out-facepile").animate({opacity:"1"})}),clearInterval(e))},1e3)},a.layout_fixes=function(){a.summary_bar_text_truncation();var e=t("#activity-title").text().split(" ");e.length>2&&(e[e.length-2]+="&nbsp;"+e[e.length-1],e.pop(),t("#activity-title").html(e.join(" "))),t("#insider-column").css({"min-height":t("#insider-column").height()})},a.summary_bar_text_truncation=function(){function e(e){if(e.length>0){var t,i,o;e.dotdotdot({height:16,ellipsis:""}),t=e.triggerHandler("originalContent"),i=e.text(),o=t.text().replace(e.text(),""),e.html(""),e.append(i+"<br>"+o),e.css({"line-height":"1.1em"})}}e(t("#summary-bar .where .text")),e(t("#summary-bar .neighborhood .text"))},a.primary_actions=function(){var e,i,a;return r?(t("#add-to-bookmarks-button").click(function(){var i;return n.activity_objects[n.activity_id].bookmarked?(e=-1,n.bookmark_undo(),n.bookmark_callback()):(e=1,i=n.setup_cinematic_popup_data(t(this)),a=o.to_html(n.popup_templates.cinematic_shell,t.extend(i,{popup_title:"Bookmark This Activity",show_tooltip:!0}),{pane:n.popup_templates.bookmark_pane}),n.show_bookmark_popup(a,"Activity Details")),n.log_click("Primary Actions","Bookmark",{undo_bookmark:-1===e}),!1}),t("#add-to-bookmarks-container").on("mouseenter","#add-to-bookmarks-button.selected",function(){t(this).find(".button-text").text("Undo")}).on("mouseleave","#add-to-bookmarks-button.selected",function(){t(this).find(".button-text").text("Bookmarked")}),t("#mark-as-done-button").click(function(){var e,a=n.setup_cinematic_popup_data(t(this));n.activity_objects[n.activity_id].done_it?(i=-1,n.done_it_undo(),n.done_callback()):(i=1,e=o.to_html(n.popup_templates.cinematic_shell,t.extend(a,{popup_title:"Done This Activity",tip_types:n.tip_types}),{pane:n.popup_templates.done_it_pane}),n.show_done_it_popup(e,"Activity Details"),n.initialize_select_box(n.REMOVE_BOOKMARK_COLLECTION)),n.log_click("Primary Actions","Done",{undo_done:-1===i})}),t("#mark-as-done-container").on("mouseenter","#mark-as-done-button.full-width",function(){t(this).find(".button-text").text("Undo")}).on("mouseleave","#mark-as-done-button.full-width",function(){t(this).find(".button-text").text("I've Done This")}),n.bookmark_callback=function(){t("#global-bookmark-count").text(parseInt(t("#global-bookmark-count").text(),10)+e),t("#add-to-bookmarks-button .button-text").text(e>0?"Bookmarked":"Bookmark It")},void(n.done_callback=function(){t("#global-done-count").text(parseInt(t("#global-done-count").text(),10)+i),i>0?(t("#mark-as-done-button .button-text").text("I've Done This"),t("#global-bookmark-count").text(parseInt(t("#global-bookmark-count").text(),10)-1)):(t("#mark-as-done-button .button-text").text("Done It"),t("#add-to-bookmarks-button .button-text").text("Bookmark It"))})):!0},a.share_actions=function(){r?(t("#fb-share").click(function(e){var i,a=n.setup_cinematic_popup_data(t(this));return i=o.to_html(n.popup_templates.cinematic_shell,t.extend(a,{popup_title:"Share On Facebook"}),{pane:n.popup_templates.facebook_share_pane}),n.show_facebook_share_popup(i,"Activity Details",e.target.id),n.log_click("Share Actions","Facebook",{}),!1}),t("#tw-share").click(function(e){var i,a=n.setup_cinematic_popup_data(t(this));return i=o.to_html(n.popup_templates.cinematic_shell,t.extend(a,{popup_title:"Share on Twitter"}),{pane:n.popup_templates.twitter_share_pane}),n.show_twitter_share_popup(i,e.target.id),n.log_click("Share Actions","Twitter",{}),!1}),t("#share-button").click(function(){t(this).toggleClass("enabled"),t("#share-options-dropdown").slideToggle(),t("#share-button").data("short-link-loaded")||(t("#share-button").data("short-link-loaded",!0),n.server_call("load_activity_details_short_link",{activity_id:n.activity_id},function(e){t("#short-link").val(e.short_link)})),n.log_click("Share Actions","Share Dropdown",{})}),t("#short-link").click(function(){t("#short-link").select(),n.log_click("Share Actions","Short Link",{})})):(t("#fb-share").click(function(){var e=350,o=350,a=screen.width/2-e/2,r=screen.height/3-o/2;return window.open(t("#fb-share").data("href"),"Facemash","menubar=0,resizable=0,width="+e+",height="+o+",left="+a+",top="+r),n.log_click("Share Actions","Logged-out Facebook share",{}),i.push(["_trackSocial","facebook","logged-out activity share"]),!1}),t("#tw-share").click(function(){var e=550,o=450,a=screen.width/2-e/2,r=screen.height/3-o/2;return window.open(t("#tw-share").data("href"),"Toot","menubar=0,resizable=0,width="+e+",height="+o+",left="+a+",top="+r),n.log_click("Share Actions","Logged-out Twitter share",{}),i.push(["_trackSocial","twitter","logged-out activity share"]),!1}))},a.mapbox=function(e,t,i,o){var a,r=o;a=L.mapbox.map("map-inner",e).setView([t,i],o),a.zoomControl=!0,L.marker([t,i],{icon:L.icon({iconUrl:n.make_static_url("/images/blank.gif"),className:"marker-image",iconSize:[26,38],iconAnchor:[13,38]})}).addTo(a),a.on("zoomend",function(e){r-e.target._zoom>0?n.log_click("Map Box","Zoom",{zoom_direction:"out",from_initial:e.target._zoom<o}):n.log_click("Map Box","Zoom",{zoom_direction:"in",from_initial:e.target._zoom>o}),r=e.target._zoom})},a.insider_tips=function(e){var i,r,c,s=0,l=t(".insider-unit").length,d=t("#insider-next-button"),u=t("#insider-prev-button"),_=t("#write-a-tip-button");i=function(e){t(".insider-unit").slice(3*s,3*(s+1)).hide(),s+=e,t(".insider-unit").slice(3*s,3*(s+1)).show(),s>=l/3-1?d.addClass("disabled"):d.removeClass("disabled"),s>0?u.removeClass("disabled"):u.addClass("disabled")},a.user_added_tip=function(){t("#empty-insider-text").length>0&&t("#empty-insider-text").remove(),t(".insider-unit").hide(),t(".insider-unit").slice(0,2).show(),t(".insider-unit").length>3&&(s=0,u.addClass("disabled"),d.removeClass("disabled"),t("#insider-buttons").is("visible")===!1&&t("#insider-buttons").show())},e&&(c=n.setup_cinematic_popup_data(_)),r=o.to_html(n.popup_templates.cinematic_shell,t.extend(c,{popup_title:"Tell us about it!",tip_types:n.tip_types}),{pane:n.popup_templates.add_tip_pane}),_.click(function(){return e?void n.add_tip_popup(r,"Activity Details"):!0}),d.click(function(){!t(this).hasClass("disabled")&&l/3>s&&(i(1),n.log_click("Insider","Pagination",{activity_id:n.activity_id,direction:"next"}))}),u.click(function(){!t(this).hasClass("disabled")&&s>0&&(i(-1),n.log_click("Insider","Pagination",{activity_id:n.activity_id,direction:"prev"}))})},a.show_friends_actions=function(e,i,o){var a,r;r=n.make_spinner_dialog("Loading…","Loading users…"),n.server_call("get_all_people",{list_type:e,item_id:i,user_id:o},function(e){r.dragonPopup("close"),0!==e.rc?n.alert(e.message):(a=t("<div/>").addClass("userlist"),t.each(e.users,function(e,i){a.append(t("<div>").addClass("userlist-user").append(t("<img>").attr({src:i.avatar}),t("<a>").attr({href:i.link}).text(i.name)))}),a.dragonPopup({title:e.title,minWidth:250,maxWidth:500}))})},e}(OFFLINE||{},jQuery,_gaq,Mustache),OFFLINE=function(e,t,i,o){"use strict";var n=e.base=e.base||{},a=e.dragon=e.dragon||{},r=a.home=a.home||{},c=e.logger=e.logger||{};return r.init=function(e){function i(){t("#activity-tooltip").show(),t("#activity-tooltip").addClass("animated bounceIn"),setTimeout(function(){t("#neighborhood-tooltip").show(),t("#neighborhood-tooltip").addClass("animated bounceIn"),setTimeout(function(){t("#bookmark-tooltip").show(),t("#bookmark-tooltip").addClass("animated bounceIn")},1e3)},1e3)}function o(){p||requestAnimationFrame(s),p=!0}function s(){p=!1;var e=_;e+m.win.height()>m.doc.height()-200&&r.working_set.slice(9*r.current_page,9*(r.current_page+1)).length>0&&r.draw_activities(r.working_set,r.promo_activities,!1),!r.activity_filter_fixed&&_>u?(t("#filter-and-sort-bars").addClass("fixed"),t("#activity-outer").addClass("fixed"),r.activity_filter_fixed=!0):r.activity_filter_fixed&&u>_&&(t("#filter-and-sort-bars").removeClass("fixed"),t("#activity-outer").removeClass("fixed"),r.activity_filter_fixed=!1)}var l={activity_template:null,collection_id:null,show_tooltips:null,logging_cat_dict:null,logging_neigh_dict:null,first_timer:null,promo_template:null},d=t.extend({},l,e),u=t("#activity-filter").offset().top;r.current_page=0,r.homepage_activities=[],r.working_set=[],r.working_set_promo=[],r.active_filters={},r.social_proof={},r.collection_id=d.collection_id,r.logging_dict={},r.logging_dict.category=d.logging_cat_dict,r.logging_dict.neighborhood=d.logging_neigh_dict,r.setup_click_handlers(),r.setup_sort_functions(),r.activity_filter_fixed=!1,r.new_activities_template="<div class='clearfix'><div id='new-activities-text'><div id='new-count'>{0}</div><div id='new-text'>New on Sosh</div></div></div>",r.single_activity_template=d.activity_template,r.promo_activity_template=d.promo_template,r.$activity_container=t("#activity-container"),d.show_tooltips&&(d.first_timer||(t("#new-home-intro-modal").modal({overlayCss:{"background-color":"white"},appendTo:t("#new-home"),opacity:95,minWidth:900,minHeight:400}),t("#new-home-intro-modal #close-button").click(function(){t.modal.close(),i()}))),t(".chzn").chosen({disable_search_threshold:10}),t("#sort-by").show(),a.create_spinner(t("#spinner-box"),7,"#666"),t("#loading-container").show(),n.server_call("get_homepage_activities",{},function(e){return 1!==e.rc?(t("#loading-container").remove(),void t("#error-container").show()):(r.homepage_activities=e.activity_list,r.promo_activities=e.promoted_activities,r.promos_added=0,t("#loading-container").remove(),r.draw_activities(r.homepage_activities,r.promo_activities,!0),e.new_count>0&&r.$activity_container.prepend(r.new_activities_template.format(e.new_count)),d.show_tooltips&&(r.$activity_container.find(".single-activity-box").eq(1).append('<div id="bookmark-tooltip" class="tooltip-help"></div>'),d.first_timer&&i()),c.log_view("Homepage v3","Page Load",{new_activities:e.new_count}),void 0)});var _=0,p=!1,m={win:t(window),doc:t(document)};t(window).scroll(function(){_=window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,o()}),r.social_proof_template="<a class='mugshot-tooltip' href='{1}' title='{2}' target='_blank'><img class='sp-img' src='{0}' height='26' width='26'/></a>"},r.setup_click_handlers=function(){t(".filter-select").click(function(){var e,i,o="#"+t(this).data("filter-id");0===t("#filter-container:visible").length?(t(o).show(),t("#filter-container").slideDown(),i=!0):t(o).is(":visible")?(t("#filter-container").slideUp(function(){t(o).hide()}),i=!1):(e=t(".filter-options:visible"),t(o).show(),e.hide(),i=!0),t("#activity-tooltip, #neighborhood-tooltip").hide(),c.log_click("Homepage v3","Filter Dropdown",{"filter-type":t(this).data("filter-id"),opened:i})}),t(".filter-sub, .show-all-activities-button, .show-all-neighborhoods-button").click(function(){var e=t(this).parents(".filter-options").data("filter-type"),i=t(this).data("fid"),o=r.homepage_activities,n=r.promo_activities;t("#filter-container").slideUp(function(){t(".filter-options").hide()}),t("#"+e+"-select").text(t(this).text()),"clear"===i?delete r.active_filters[e]:r.active_filters[e]=i,t.each(r.active_filters,function(e,t){o=r.filter_activities(e,t,o),n=r.filter_activities(e,t,n)
}),r.draw_activities(o,n,!0),"filter-sub"!==t(this).attr("class")?c.log_click("Homepage v3","Filter Select",{"filter-type":e,filter:t(this).attr("class").replace("-button",""),num_results:r.working_set.length}):c.log_click("Homepage v3","Filter Select",{"filter-type":e,filter:t(this).text(),num_results:r.working_set.length})}),t("#sort-order").change(function(){var e=r.homepage_activities;t.each(r.active_filters,function(t,i){e=r.filter_activities(t,i,e)}),r.draw_activities(e,r.promo_activities,!0),c.log_click("Homepage v3","Sort",{"sort-type":t("#sort-order").val()})}),t("#activity-outer, #global-header-wide-1080, .header-dropdown").click(function(){t("#filter-container").slideUp(function(){t(".filter-options").hide()})}),t(".bm-icon").live("click",function(){var e,i=t(this).parents(".single-activity-box"),o=i.find(".num-bookmarks"),n=i.data("actid");return t(this).parents(".bookmarks").toggleClass("bookmarked"),i.data("bookmarked",!i.data("bookmarked")),o.text(i.data("bookmarked")===!0?parseInt(o.text(),10)+1:parseInt(o.text(),10)-1),t.each(r.homepage_activities,function(e){return r.homepage_activities[e].act_id===n?(r.homepage_activities[e].bookmarked=i.data("bookmarked"),!1):void 0}),e={activity_id:i.data("actid"),value:i.data("bookmarked")===!0,src:"new_home_web",message:"",collection_id:r.collection_id,strid:"1"},a.server_call("bookmark_activity",e),c.log_click("Homepage v3","Bookmark",{page:r.current_page,bookmarked:i.data("bookmarked")===!0,activity_strid:i.data("actid")}),!1}),t(".activity-link").live("click",function(){var e,i=t(this).data("promo")?!0:!1,o="Activity Details";i&&(e=t(this).hasClass("curated")?"curated promo":"marketplace promo",o="Homepage Promo Item"),c.log_click("Homepage v3",o,{page:r.current_page,social_proof:t(this).find(".mugshot-tooltip").length,category:r.logging_dict.category[r.active_filters.categories]||"none",neighborhood:r.logging_dict.neighborhood[r.active_filters.neighborhoods]||"none",sort:t("#sort-order").val(),is_promo:i,content_type:t(this).data("contentType"),promo_type:e})})},r.filter_activities=function(e,i,o){var n=[];return t(o).each(function(o,a){-1!==t.inArray(i,a[e])&&(n=n.concat(a))}),n},r.sort_activities=function(e,i){return"activity_date"===e&&(i=t.grep(i,function(e){return""!==e.activity_date_text})),i.sort(r.activity_sort_functions[e]),i},r.draw_activities=function(e,i,s){if(s&&(e=r.sort_activities(t("#sort-order").val(),e),r.$activity_container.empty(),r.current_page=0,r.promos_added=0,r.list_offset=0,r.working_set=e,r.working_set_promo=JSON.parse(JSON.stringify(i)),t("#num-results-container > #num-results").text(e.length),t(document).scrollTop(0)),e.length>0){t("#no-results:visible").hide();var l=e.slice(9*r.current_page,9*(r.current_page+1)),d=o.to_html(r.single_activity_template,{acts:l}),u=t("<div>"+d+"</div>"),_=[];if(r.working_set_promo.length>0&&r.promos_added<r.working_set_promo.length){var p=r.working_set_promo[r.promos_added],m=o.to_html(r.promo_activity_template,p);u.find(".activity-link:nth-child(3)").after(m),r.promos_added++}r.$activity_container.append(u),u.find(".title").each(function(e,t){window.$clamp(t,{clamp:2})}),u.find(".venue").each(function(e,t){window.$clamp(t,{clamp:2})}),u.find(".activity-link").each(function(e,i){var o=t(i).find(".activity-info")[0],n=t(i).find(".single-activity-box").data("actid"),c=r.list_offset+e,s={};s.activity_strid=n,s.list_position=c,r.active_filters.categories&&(s.filter_pcat=r.active_filters.categories),r.active_filters.neighborhoods&&(s.filter_pneighborhood=r.active_filters.neighborhoods),t(i).hasClass("promo-full")&&(s.featured="Homepage v3 Promo Full",o=i),a.summary_view_log_in_view(o,"Homepage v3",s)}),r.current_page=r.current_page+1,r.list_offset=9*r.current_page+r.promos_added,t.each(l,function(e,i){-1===t.inArray(i.act_id,t.keys(r.social_proof))&&(_=_.concat(i.act_id))}),n.server_call("homepage_get_social_proof",{activity_strids:_.join()},function(e){t.each(e.social_proof,function(e,i){t.each(i.slice(0,5),function(i,o){t("#"+e+" .sp-container").append(r.social_proof_template.format(o.mugshot,o.url,o.name))})}),t.extend(r.social_proof,e.social_proof),t(".mugshot-tooltip[title]").tooltip({position:"top center",opacity:.9,offset:[0,0]}),c.log_view("Homepage v3","Activity Page",{page:r.current_page-1,acts_w_social_proof:e.social_proof.length,category:r.logging_dict.category[r.active_filters.categories]||"none",neighborhood:r.logging_dict.neighborhood[r.active_filters.neighborhoods]||"none",sort:t("#sort-order").val()})})}else t("#no-results").show(),c.log_view("Homepage v3","No Results",{category:r.logging_dict.category[r.active_filters.categories]||"none",neighborhood:r.logging_dict.neighborhood[r.active_filters.neighborhoods]||"none"})},r.setup_sort_functions=function(){r.activity_sort_functions={},r.activity_sort_functions.bookmarks=function(e,t){return e.num_bookmarks>t.num_bookmarks?-1:e.num_bookmarks<t.num_bookmarks?1:0},r.activity_sort_functions.published=function(e,t){return e.published_on>t.published_on?-1:e.published_on<t.published_on?1:0},r.activity_sort_functions.activity_date=function(e,t){return e.activity_date<t.activity_date?-1:e.activity_date>t.activity_date?1:0},r.activity_sort_functions.my_bookmarks=function(e,t){return e.bookmarked>t.bookmarked?-1:e.bookmarked<t.bookmarked?1:0}},r.select_random_prop_key=function(e){var t,i=0;for(var o in e)Math.random()<1/++i&&(t=o);return t},e}(OFFLINE||{},jQuery,_gaq,Mustache),OFFLINE=function(e,t,i){"use strict";var o=e.dragon=e.dragon||{},n=o.header=o.header||{},a=e.base=e.base||{};return n.init=function(){n.setup_header(),n.setup_autocomplete(),n.setup_spinner(),n.search_query_log_cache=[],n.autocomplete_row_num_results="<div class='search-help-text'>             <div class='left-text'>Search for <span>{0}</span></div>             <div class='right-text'>{1} RESULTS</div>         </div>",n.autocomplete_row_activity="<a>             <img class='activity-image' src='{0}'>             <div class='activity-info'>                 <div class='activity-title ellipsis'>{1}</div>                 <div class='activity-venue ellipsis'>{2}</div>             </div>             <div class='activity-neighborhood ellipsis'>{3}</div>         </a>",n.autocomplete_row_category="<a>             <div class='category-icon' src='{0}'></div>             <div class='category-title'>{1}</div>         </a>"},n.log_search_query_no_dups=function(e,i){-1===t.inArray(t("#search-field").val(),n.search_query_log_cache)&&(o.log_search_query("Header",i,{search_type:e}),n.search_query_log_cache=n.search_query_log_cache.concat(i))},n.setup_spinner=function(){var e,o={lines:8,length:2,width:2,radius:5,color:"#666",speed:1,trail:60,shadow:!1};e=new i(o).spin(),t("#spinner-container").append(e.el)},n.setup_header=function(){t(".header-dropdown").click(function(){return t(".header-menu-container:visible").not(t(this).siblings(".header-menu-container")).length&&n.dropdown_animate(t(".header-dropdown:visible").not(t(this)).siblings(".header-menu-container")),n.dropdown_animate(t(this).siblings(".header-menu-container")),!1}),t("body, #search-field").click(function(){return t(".header-menu-container:visible").length&&n.dropdown_animate(t(".header-menu-container:visible")),!0})},n.switch_geo=function(e,i,r){return e===a.active_geography?!1:void(e!==a.sosh_edition?(t("#switch-geo-popup").modal({overlayCss:{"background-color":"black"}}),o.log_view("Popups","Switch Geo Popup",{new_geo:i}),t("#switch-geo-popup #geo-popup-name").text(i),t("#switch-geo-popup #geo-popup-abrv").text(r),t("#cancel-button").click(function(){o.log_click("Switch Geo Popup","Switch Geo",{button:"cancel"}),t.modal.close()}),t("#switch-geo-popup #just-browsing, #switch-geo-popup #moved").click(function(){var i=!1,a="just-browsing";"moved"===t(this).attr("id")&&(i=!0,a="moved"),o.log_click("Switch Geo Popup","Switch Geo",{button:a}),n.switch_geo_commit(e,i)})):n.switch_geo_commit(e,!1))},n.switch_geo_commit=function(e,t){o.server_call("switch_geo",{new_geo:e,moved:t},function(e){0===e.rc&&(e.redirect_url?window.location=e.redirect_url+"&next="+window.location.pathname:location.reload())})},n.dropdown_animate=function(e){e.is(":visible")?(e.fadeOut({duration:400}).animate({top:"35px"},{duration:400,queue:!1}),o.log_click("Header",e.data("name")+" Dropdown",{action:"hide"})):(e.fadeIn({duration:400}).animate({top:"45px"},{duration:400,queue:!1}),o.log_click("Header",e.data("name")+" Dropdown",{action:"show"}))},n.setup_autocomplete=function(){var e,i={},a=t("#search-field");a.length&&(a.keypress(function(e){13===e.which&&t("#search-field").attr("value").length>0&&(o.log_click("Header","Search",{action:"Execute Search",query:a.val(),method:"enter key"}),n.log_search_query_no_dups("Full Search",a.val()),setTimeout(function(){window.location="/search/?q="+a.val()},100))}),i[""]=[{id:-1,value:"Start typing for suggestions. Press enter to search.",type:""}],a.autocomplete({minLength:0,delay:400,source:function(a,r){var c;return e=a.term,e in i?void r(i[e]):void(c=t.getJSON("/jx/search_auto",a,function(t,a,s){var l=t.categories.concat(t.activities).concat(t.users);l.length>0?l.push({id:-2,value:"Search for more results",type:""}):l.unshift({id:-3,value:"Num Results",type:"",num_results:l.length}),i[e]=l,s===c&&e===t.term&&(o.log_click("Header","Search",{action:"Search Results Displayed",query:t.term,num_results:l.length-1}),n.log_search_query_no_dups("Autocomplete",t.term),o.log_search_results(t.term,{num_results:l.length-1,num_cats:t.categories.length,num_activities:t.activities.length,num_users:t.users.length,search_type:"Autocomplete",activity_ids:t.activity_ids}),r(l))}))},appendTo:"#search-autocomplete-holder",select:function(e,i){return-1===i.item.id||-3===i.item.id||(-2===i.item.id?(t("#spinner-container").show(),o.log_click("Header","Search",{action:"Execute Search",query:a.val(),method:"dropdown more results click"}),setTimeout(function(){window.location="/search/?q="+t("#search-field").attr("value")},100)):i.item.url?(t("#spinner-container").show(),o.log_click("Header","Search",{action:"Select Autocomplete Suggestion",query:a.val(),type:i.item.type,id:i.item.id}),o.log_search_click("Header",a.val(),{search_type:"Autocomplete",object_type:i.item.type,object_id:i.item.id}),setTimeout(function(){window.location.href=i.item.url},100)):setTimeout(function(){window.location="/search/?q="+t("#search-field").attr("value")},100)),!1},focus:function(e){e.preventDefault()},search:function(){t("#spinner-container").show()},open:function(){t("#spinner-container").hide(),t("#search-autocomplete-holder > .header-menu-tooltip").show()},close:function(){t("#search-autocomplete-holder > .header-menu-tooltip").hide()}}).data("autocomplete")._renderItem=function(e,i){var r,c;return-1===i.id?r="<div class='search-help-text'><div class='left-text'>Search for <span>activities, categories, or friends</span></div></div>":-2===i.id?r="<a style='text-align: center;'><div class='more-results'>Search For More Results</div></a>":-3===i.id?r=n.autocomplete_row_num_results.format(a.val(),i.num_results):(c=i.name.replace(new RegExp("("+a.val()+")","i"),"<span class='search-highlight'>$1</span>"),"Activity"===i.type?(r=n.autocomplete_row_activity.format(i.image,c,"at "+i.venue,i.neighborhood),o.log_summary_view("search_ac",{activity_strid:i.strid,featured:"search_ac",list_position:i.list_position,q:t("#search-field").attr("value")})):r="Sosh Member"===i.type?n.autocomplete_row_activity.format(i.image,c,i.type,""):n.autocomplete_row_category.format("",c)),t("<li></li>").data("item.autocomplete",i).append(r).appendTo(e)},a.focus(function(){o.log_click("Header","Search",{action:"Focus On Search Box"}),t(this).autocomplete("search")}))},e}(OFFLINE||{},jQuery,Spinner),OFFLINE=function(e,t){"use strict";var i=e.dragon=e.dragon||{},o=i.settings=i.settings||{},n=e.logger;return o.init=function(){var e=t(".ui-corner-all").text();o.getDomEls_(),t(".chzn").chosen({disable_search_threshold:10}),o.twitterDisconnect.bind("click",o.twitterDiscFn),o.foursquareDisconnect.bind("click",o.foursquareDiscFn),o.connectTwitter.bind("click",function(){t("#twitter-container").hasClass("connected")||t(".twitter-connect-button").submit()}),o.connectFoursquare.bind("click",function(){t("#foursquare-container").hasClass("connected")||t(".foursquare-connect-button").submit()}),t(".ui-corner-all").hide(),o.showMessage(e),o.validator=t(".settings-form").validate({onfocusout:function(e){t(e).valid()},submitHandler:o.submitFn,rules:{new_password:{minlength:6},confirm_password:{equalTo:'input[name="new_password"]'}},messages:{first_name:"INVALID FIRST NAME",last_name:"INVALID LAST NAME",email:"INVALID EMAIL ADDRESS",old_password:"INVALID PASSWORD",new_password:"INVALID PASSWORD",confirm_password:"INVALID PASSWORD"}}),t(".submit-button").bind("click",function(){t(".settings-form").submit()}),t(".show-button").bind("click",function(){t(this).hide(),t("#"+t(this).data("show_section")).fadeIn(400,function(){})}),t("#delete-reason").on("change",function(e,i){"0"===i.selected?(t("#final-delete:visible").hide(),t(".troubleshooting-options").hide(),t(".help-text").hide()):t("#"+i.selected).length>0?(t("#final-delete:visible").hide(),t(".troubleshooting-options").show(),t(".help-text").hide(),t("#"+i.selected).show()):(t(".troubleshooting-options:visible").hide(),t("#final-delete:hidden").show())}),t("#delete-two").click(function(){t(this).parent().hide(),t("#final-delete").fadeIn(),n.log_click("Account Delete","Reason Selected Delete Account Text")}),t("#perm-delete-button").click(function(){t("#delete-confirm-modal").modal({overlayCss:{"background-color":"white"},appendTo:"#delete-container",opacity:85,minHeight:"300px",maxWidth:"500px"}),n.log_click("Account Delete","Permanently Delete Account Button",{reason:t("#delete-reason").val()})}),t("#cancel-delete").click(function(){t.modal.close(),n.log_click("Account Delete Modal","Modal Cancel")}),t("#confirm-delete").click(function(){n.log_click("Account Delete Modal","Modal Confirm"),t("#confirm-delete").data("clicked")||(t("#confirm-delete").data("clicked",!0),i.server_call("perm_account_delete",{delete_reason:t("#delete-reason").val(),comment:t("#final-delete textarea").val()},function(e){window.location=e.url}))}),t(".troubleshooting-options a").not("#delete-two").click(function(){n.log_click("Help Text",t(this).closest("div").attr("id"))})},o.getDomEls_=function(){o.connectTwitter=t("#twitter-container"),o.connectFoursquare=t("#foursquare-container"),o.twitterDisconnect=t("#twitter-container.connected .disconnect-button"),o.foursquareDisconnect=t("#foursquare-container.connected .disconnect-button")},o.twitterDiscFn=function(){i.server_call("disconnect_twitter",{},function(e){t("#twitter-container").removeClass("connected"),t(this).detach(),t("#twitter-container span").text("Connect Twitter"),o.showMessage(e.message)})},o.foursquareDiscFn=function(){i.server_call("disconnect_foursquare",{},function(e){t("#foursquare-container").removeClass("connected"),t(this).detach(),t("#foursquare-container span").text("Connect FourSquare"),o.showMessage(e.message)})},o.showMessage=function(e,i,o){o=o||function(){},e&&(t(".message-container").text(e),i?t(".message-container").addClass("error"):t(".message-container").removeClass("error"),t(".message-container").slideDown("slow",o))},o.submitFn=function(e){var n,a=t(e),r=a.data("action"),c=a.find("input:filled, textarea:filled, select"),s={};return t.each(c,function(e,i){i=t(i),"checkbox"!==i.attr("type")?s[i.attr("name")]=i.val():i.attr("checked")&&(s[i.attr("name")]?(n=s[i.attr("name")],"object"==typeof n?n.push(i.val()):s[i.attr("name")]=[n,i.val()]):s[i.attr("name")]=i.val())}),t('input[name="old_password"]').length>0&&s.old_password===s.new_password?(o.validator.showErrors({new_password:"NEW PASSWORD SAME AS OLD"}),!1):void i.server_call(r,s,function(e){var i=e.error_el,n={},a=!1;e.rc&&(a=!0,i&&(n[i]="INVALID PASSWORD",o.validator.showErrors(n))),t('input[type="password"]').each(function(e,i){t(i).val("")}),t("body").animate({scrollTop:0},"slow","swing",function(){o.showMessage(e.message,a,function(){e.redirect_url&&(document.location=e.redirect_url)})})})},e}(OFFLINE||{},jQuery),OFFLINE=function(e,t){"use strict";var i=(e.base=e.base||{},e.dragon=e.dragon||{}),o=i.signup=i.signup||{},n=e.logger=e.logger||{};return o.init=function(e,a,r,c){var s=0;a&&t(".bottom-image").first().css({"background-image":"url("+a+")"}),s=""===e?-1:e,n.log_view("Signup Pane","Select Geo",{selected_geo:s}),o.selected_geo=e,o.button_locks={},i.setup_dragon_dropdown(t("#geo-dropdown"),"Select a City",o.dropdown_select_callback,o.dropdown_click_callback),o.button_handlers(r,c),o.share_actions(),o.validation(),t(window).resize(function(){o.resize_handler()}),o.resize_handler(),t("#primary-container").fadeIn()},o.resize_handler=function(){window.innerHeight>t("#signup-container").height()+t(".bottom-image:visible").height()?(t("#primary-container").addClass("vertical_center"),t(".bottom-image").addClass("fixed")):(t("#primary-container").removeClass("vertical_center"),t(".bottom-image").removeClass("fixed")),t("#primary-container.vertical_center").css({"margin-top":window.innerHeight/2-t("#primary-container").height()})},o.button_handlers=function(e,i){t("#why-facebook-link").click(function(){t("#why-facebook-modal").modal({overlayCss:{"background-color":"white"},appendTo:"#signup-container",opacity:85,minWidth:370,minHeight:380}),n.log_view("Signup Modal","Why Facebook Modal",{selected_geo:o.selected_geo}),t("#why-facebook-modal-close").click(function(){n.log_click("Select Geo Pane","Why Facebook Close",{selected_geo:o.selected_geo}),t.modal.close()}),n.log_click("Select Geo Pane","Why Facebook",{selected_geo:o.selected_geo})}),t("#fb-signup-button").click(function(){o.button_locks["fb-signup-button"]||(o.facebook_connect(e,i,!0,!1),n.log_click("Select Geo Pane","Sign Up",{selected_geo:o.selected_geo}))}),t("#priority-list-button").click(function(){o.button_locks["priority-list-button"]||(n.log_click("Select Geo Pane","Priority List",{selected_geo:o.selected_geo}),o.button_locks["priority-list-button"]=!0,t("#email-priority-list-form").submit())}),t("#wait-list-button").click(function(){o.button_locks["wait-list-button"]||(n.log_click("Wait List","Join Wait List",{selected_geo:o.selected_geo}),o.button_locks["wait-list-button"]=!0,t("#email-wait-list-form").submit())}),t("#zipcode-submit-button").click(function(){o.button_locks["zipcode-submit-button"]||(n.log_click("Zipcode Verify Pane","Zipcode Submit",{selected_geo:o.selected_geo}),o.button_locks["zipcode-submit-button"]=!0,t("#zipcode-form").submit())}),t("#facebook-cancel-modal #continue").click(function(){n.log_click("Modal","Facebook Cancel Modal Continue",{selected_geo:o.selected_geo}),t.modal.close()}),t(".text-input").click(function(){t(this).removeClass("invalid")}),t("#sign-in").click(function(){n.log_click("Header","Sign In",{}),o.facebook_connect(e,i,!0,!0)})},o.dropdown_click_callback=function(e,t){e?n.log_click("Select Geo Pane","Dropdown Action",{action:"opened",selected_geo:t}):n.log_click("Select Geo Pane","Dropdown Action",{action:"closed",selected_geo:t})},o.dropdown_select_callback=function(e){t("#geo-dropdown").data("value",e.data("value")),o.selected_geo=e.data("value"),t(".bottom-image:hidden").css({"background-image":"url("+e.data("image")+")"});var i=t(".bottom-image:hidden"),a=t(".bottom-image:visible");i.fadeIn(),a.fadeOut(),o.button_locks["fb-signup-button"]=e.data("can-signup")?!1:!0,setTimeout(function(){e.data("can-signup")?t(".plist-item").fadeOut(function(){t(".signup-item:hidden").fadeIn()}):t(".signup-item").fadeOut(function(){t(".plist-item:hidden").fadeIn()})},300),n.log_click("Select Geo Pane","Dropdown Select",{selected_geo:e.data("value"),can_signup:e.data("can-signup")})},o.facebook_connect=function(e,a,r,c){"undefined"!=typeof FB&&null!==FB?FB.login(function(e){var s=!1;e.authResponse?(c===!1&&(i.create_spinner(t("#signup-container .spinner"),5,"#CCC"),t("#fb-signup-button").hide()),r?(o.fb_connect(a,c),s=!0):e.authResponse.userID&&i.server_call("signup/is_fb_user_a_user",{fb_uid:e.authResponse.userID},function(e){0===e.rc?(o.fb_connect(a,c),s=!0):window.location="/signup"})):c||(t("#facebook-cancel-modal").modal({overlayCss:{"background-color":"white"},appendTo:"#signup-container",opacity:70,minWidth:780,minHeight:430}),n.log_view("Signup Modal","Facebook Cancel Modal",{selected_geo:o.selected_geo})),OFFLINE.dragon&&t.isFunction(OFFLINE.dragon.fb_button_callback)&&OFFLINE.dragon.fb_button_callback(s)},{scope:e}):(i.display_error("Unable to connect with Facebook. If you have a Facebook Blocker extension installed in your browser, please disable it and try again."),n.log_view("Signup","Facebook Connect Error: FB is not defined"))},o.show_signup_login_popup=function(e,a,r){var c,s=t(e.currentTarget).hasClass("login-link-interrupt");return i.logged_in?!0:(a?(t("#signup-login-modal #header-message").text(a),t("#signup-login-modal #sub-message").text(r)):t("#signup-login-modal #header-message").text(s?"You Must be a Member to do that!":"Welcome."),t("#signup-login-modal").modal({overlayCss:{"background-color":"white"},opacity:92,minWidth:700}),n.log_view("Signup Modal","Login Modal"),t("#signup-login-modal #fb-login-button").click(function(){var e=t(this);return clearTimeout(c),"1"!==e.data("button-lock")&&(e.data("button-lock","1"),o.facebook_connect(i.facebook_perms,window.location.href,!1,!1),n.log_click("Login Modal","Login")),c=setTimeout(function(){e.data("button-lock","0")},3e3),!1}),t("#signup-login-modal #use-email").click(function(){n.log_click("Login Modal","Use Email"),setTimeout(function(){window.location="/accounts/login?email=true&next="+encodeURIComponent(window.location.href)})}),t("#signup-login-modal #close").click(function(){n.log_click("Login Modal","Close"),t.modal.close()}),!1)},o.show_welcome_to_sosh_modal=function(){t("#welcome-to-sosh-modal").modal({overlayCss:{"background-color":"white"},opacity:90,minWidth:700}),n.log_view("Signup Modal","Welcome To Sosh Modal"),t("#welcome-to-sosh-modal #continue").click(function(){n.log_click("Welcome Modal","Close"),t.modal.close(),i.intro_follow_init()})},o.fb_connect=function(e,a){var r=function(r){0===r.rc?(n.log_event("Signup","FB Connect","User Created",{signup_flow:"one-step"}),setTimeout(function(){window.location=e?e:r.url},500)):1===r.rc?(n.log_event("Signup","FB Connect","Existing User Login"),setTimeout(function(){window.location=e?e:r.url},500)):2===r.rc?a||(t("#facebook-cancel-modal").modal({overlayCss:{"background-color":"white"},appendTo:"#signup-container",opacity:70,minWidth:780,minHeight:430}),n.log_view("Signup Modal","Facebook Cancel Modal",{selected_geo:o.selected_geo})):3===r.rc?(t("#signup-select-geo").fadeOut(function(){t("#signup-verify-location").fadeIn()}),n.log_view("Signup Pane","Zipcode Verify",{selected_geo:o.selected_geo})):4===r.rc?(i.display_error(r.msg),n.log_view("Signup Error","fb_connect",{ec:4})):(i.display_error(r.msg),n.log_view("Signup Error","fb_connect",{ec:r.rc}))};i.server_call("signup/facebook_connect",{city:t("#geo-dropdown").data("value"),ref:t.getQueryParam("ref")},r)},o.join_waitlist=function(e,a,r){var c=function(e){0===e.rc?(t("#signup-waitlist-thanks #short-link").attr("value",e.short_link),t("#signup-waitlist-thanks").data("is_dropdown_city",r),o.fb_share_link=e.fb_share_link,o.tw_share_link=e.tw_share_link,t("#signup-not-available:visible, #signup-select-geo:visible").fadeOut(function(){t("#signup-waitlist-thanks").fadeIn()}),n.log_view("Signup Pane","Wait List Thanks",{is_dropdown_city:r,selected_geo:o.selected_geo})):(i.display_error(e.msg),o.button_locks["priority-list-button"]=!1,o.button_locks["wait-list-button"]=!1,n.log_view("Signup Error","Wait List",{ec:e.rc,error:"unknown",is_dropdown_city:r}))};i.server_call("signup/join_waitlist",{email:e,city:a,city_is_geo_id:r},c)},o.verify_zipcode=function(){var e=function(e){o.button_locks["zipcode-submit-button"]=!1,0===e.rc?(n.log_event("Signup","FB Connect","User Created",{signup_flow:"Zipcode Verify"}),setTimeout(function(){window.location=e.url},500)):1===e.rc?(t("#switched-edition-modal .switch-to-edition").text(e.geo_name),t("#switched-edition-modal").modal({overlayCss:{"background-color":"white"},appendTo:"#signup-container",opacity:70,minWidth:780,maxWidth:780,minHeight:430}),n.log_view("Signup Modal","Switched Edition Modal",{switch_to:e.geo_name}),t("#switched-edition-modal #cancel").click(function(){n.log_click("Modal","Switched Edition Modal Cancel",{switch_to:e.geo_name}),t.modal.close()}),t("#switched-edition-modal #continue").click(function(){o.button_locks["switched-edition-modal-continue"]||(o.button_locks["switched-edition-modal-continue"]=!0,n.log_click("Modal","Switched Edition Modal Continue",{switch_to:e.geo_name}),i.server_call("signup/create_user_with_geo",{geo_id:e.geo_id},function(){n.log_event("Signup","FB Connect","User Created",{signup_flow:"Switched Edition"}),setTimeout(function(){window.location=e.url},500)}))})):2===e.rc?(t("#signup-not-available .city-text").text(""!==e.location?e.location:"your city"),o.location=e.location,t("#signup-verify-location").fadeOut(function(){t("#signup-not-available").fadeIn()}),n.log_view("Signup Pane","Location Not Available",{location:e.location,selected_geo:o.selected_geo})):3===e.rc?(t("#zipcode-verify").addClass("invalid"),t("#zipcode-verify").siblings(".error-display").text("Invalid zipcode"),n.log_view("Signup Error","Verify Zipcode",{zipcode:t("#zipcode-verify").val(),ec:e.rc,error:"invalid zipcode",selected_geo:o.selected_geo})):(i.display_error("There was an error. Please try again."),n.log_view("Signup Error","Verify Zipcode",{ec:e.rc,error:"unknown",selected_geo:o.selected_geo}))};i.server_call("signup/verify_zipcode",{zipcode:t("#zipcode-verify").val(),geo_id:o.selected_geo},e)},o.share_actions=function(){t("#signup-waitlist-thanks #facebook-share").click(function(){var e=500,i=300,a=screen.width/2-e/2,r=screen.height/3-i/2;return window.open("https://www.facebook.com/sharer.php?u="+o.fb_share_link,"Facemash","menubar=0,resizable=0,width="+e+",height="+i+",left="+a+",top="+r),n.log_click("Wait List Pane","Facebook Share",{selected_geo:o.selected_geo,is_dropdown_city:t("#signup-waitlist-thanks").data("is_dropdown_city")}),!1}),t("#signup-waitlist-thanks #twitter-share").click(function(){return i.post_to_twitter(o.tw_share_link,"Check out Sosh! Your personal concierge for great date ideas, secret supperclubs, new cocktail bars, & more",!0),n.log_click("Wait List Pane","Twitter Share",{selected_geo:o.selected_geo,is_dropdown_city:t("#signup-waitlist-thanks").data("is_dropdown_city")}),!1}),t("#signup-waitlist-thanks #short-link").click(function(){t("#short-link").select(),n.log_click("Wait List Pane","Short Link",{selected_geo:o.selected_geo,is_dropdown_city:t("#signup-waitlist-thanks").data("is_dropdown_city")})})},o.validation=function(){t("#zipcode-form").validate({errorClass:"invalid",onkeyup:!1,onclick:!1,onfocusout:!1,focusCleanup:!0,focusInvalid:!1,rules:{zipcode_verify:{required:!0,digits:!0,minlength:5,maxlength:5}},submitHandler:function(){o.verify_zipcode()},invalidHandler:function(){o.button_locks["zipcode-submit-button"]=!1,n.log_view("Signup Error","Verify Zipcode",{error:"invalid zipcode",selected_geo:o.selected_geo})},errorPlacement:function(){}}),t("#email-wait-list-form").validate({errorClass:"invalid",onkeyup:!1,onclick:!1,onfocusout:!1,focusCleanup:!0,focusInvalid:!1,submitHandler:function(){o.join_waitlist(t("#email-wait-list").val(),o.location,!1)},invalidHandler:function(){o.button_locks["wait-list-button"]=!1,n.log_view("Signup Error","Wait List",{error:"invalid email",selected_geo:o.selected_geo})},errorPlacement:function(){}}),t("#email-priority-list-form").validate({errorClass:"invalid",onkeyup:!1,onclick:!1,onfocusout:!1,focusCleanup:!0,focusInvalid:!1,submitHandler:function(){o.join_waitlist(t("#email-priority-list").val(),t("#geo-dropdown").data("value"),!0)},invalidHandler:function(){o.button_locks["priority-list-button"]=!1,n.log_view("Signup Error","Priority List",{error:"invalid email",selected_geo:o.selected_geo})},errorPlacement:function(){}})},e}(OFFLINE||{},jQuery);!function(){function e(e,t){function i(e,t){return d.getComputedStyle||(d.getComputedStyle=function(e){return this.el=e,this.getPropertyValue=function(t){var i=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),i.test(t)&&(t=t.replace(i,function(){return arguments[2].toUpperCase()})),e.currentStyle&&e.currentStyle[t]?e.currentStyle[t]:null},this}),d.getComputedStyle(e,null).getPropertyValue(t)}function o(t){var i=t||e.clientHeight,o=a(e);return Math.max(Math.floor(i/o),0)}function n(t){var i=a(e);return i*t}function a(e){var t=i(e,"line-height");return"normal"==t&&(t=1.2*parseInt(i(e,"font-size"))),parseInt(t)}function r(t){return t.lastChild.children&&t.lastChild.children.length>0?r(Array.prototype.slice.call(t.children).pop()):t.lastChild&&t.lastChild.nodeValue&&""!=t.lastChild.nodeValue&&t.lastChild.nodeValue!=u.truncationChar?t.lastChild:(t.lastChild.parentNode.removeChild(t.lastChild),r(e))}function c(t,i){function o(){b=u.splitOnChars.slice(0),y=b[0],v=null,g=null}if(i){var n=t.nodeValue.replace(u.truncationChar,"");if(v||(y=b.length>0?b.shift():"",v=n.split(y)),v.length>1?(g=v.pop(),s(t,v.join(y))):v=null,l&&(t.nodeValue=t.nodeValue.replace(u.truncationChar,""),e.innerHTML=t.nodeValue+" "+l.innerHTML+u.truncationChar),v){if(e.clientHeight<=i){if(!(b.length>=0&&""!=y))return e.innerHTML;s(t,v.join(y)+y+g),v=null}}else""==y&&(s(t,""),t=r(e),o());return u.animate?void setTimeout(function(){c(t,i)},u.animate===!0?10:u.animate):c(t,i)}}function s(e,t){e.nodeValue=t+u.truncationChar}t=t||{};var l,d=window,u={clamp:t.clamp||2,useNativeClamp:"undefined"!=typeof t.useNativeClamp?t.useNativeClamp:!0,splitOnChars:t.splitOnChars||[".","-","–","—"," "],animate:t.animate||!1,truncationChar:t.truncationChar||"…",truncationHTML:t.truncationHTML},_=e.style,p=e.innerHTML,m="undefined"!=typeof e.style.webkitLineClamp,f=u.clamp,h=f.indexOf&&(f.indexOf("px")>-1||f.indexOf("em")>-1);u.truncationHTML&&(l=document.createElement("span"),l.innerHTML=u.truncationHTML);var v,g,b=u.splitOnChars.slice(0),y=b[0];"auto"==f?f=o():h&&(f=o(parseInt(f)));var k;if(m&&u.useNativeClamp)_.overflow="hidden",_.textOverflow="ellipsis",_.webkitBoxOrient="vertical",_.display="-webkit-box",_.webkitLineClamp=f,h&&(_.height=u.clamp+"px");else{var w=n(f);w<=e.clientHeight&&(k=c(r(e),w))}return{original:p,clamped:k}}window.$clamp=e}();